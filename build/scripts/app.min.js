(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({"./src/scripts/app.js":[function(require,module,exports){
require('./infscr');
require('./ads');
require('./scores');


(function($){


/// Sub Nav Area Functionality
var closer;


function SubNav(event){
	window.clearTimeout(closer);
	
	var target = $(event.target).attr('targ')

	// remove red from item and link
	$('#MainNav ul li').removeClass('selected');
	$('#MainNav ul li a').removeClass('selected');
	
	// add red background to hovered item
	$(event.target).addClass('selected');
	// hide all of the sub nav
	$('#SideSubNav ul').hide();
	// show the subnav for the hovered item
	$('#' + target + '-nav').css('display', 'block');

	// slide the main content over to the right
	$('#MainContent').css('left', '320px');
	BackgroundPosition(320);
}

// activate SubNav on mouseover or click of main nav
$("#MainNav").on("click mouseover", "ul li", SubNav);


function CloseSubNav (event) {
	var mainWidth = $('#MainContent').css('left');
	mainWidth = mainWidth.replace('px', '');
	mainWidth = parseInt(mainWidth);
	// if the nav bar is open close the sub nav
	if (mainWidth >= 175) {
		closer = window.setTimeout(function () {
			// remove red from item and link
			$('#MainNav ul li').removeClass('selected');
			$('#MainNav ul li a').removeClass('selected');
			// close the sub nav
			$('#MainContent').css('left', '175px');
			// adjust the ad
			BackgroundPosition(175);
		}, 500);
	}
}


// if the mouse enters the main content close the subnav
$('main').on('mouseenter', CloseSubNav);


function ClickMenu(event) {
	if ($('#MainContent').css('left') == '30px') {
		$('#MainContent').css('left','175px');
		BackgroundPosition(175);
	} else {
		$('#MainContent').css('left','30px');
		BackgroundPosition(30);
	}
}

$('.shownav').on('click', ClickMenu);

function SideBar(){
	if($("#sidebar-ad-placeholder").height() < 250){
		ad_offset = 250
	} else {
		ad_offset = $("#sidebar-ad-placeholder").height();
	}
	var offset =  $(window).height() - ($('#HeaderContent').height() + ad_offset + 70);
	$("#SideBar").css({'margin-top': ($(window).scrollTop()), 'height': offset});
	$("#sidebar-ad-placeholder").css({'position': 'fixed', 'bottom': 10});
}

function HeaderHeight() {
	$('.header-push').css('padding-top', $('#HeaderContent').height() + 10);
}

function BackgroundPosition(mainmargin) {
	var mainwidth = $('#MainContent').width();
	var headercontent = $('#HeaderContent').height();
	var combinedwidth = mainmargin + parseInt(mainwidth);
	var combinedpos = combinedwidth + 'px ' + (headercontent + 10) + 'px'
	//console.log(combinedpos);
	$('body, html').css('background-position', combinedpos);
}

HeaderHeight();
SideBar();
BackgroundPosition($('#MainContent').position().left);

$(window).resize(function(event) {
	SideBar();
	HeaderHeight();
	BackgroundPosition($('#MainContent').position().left);
})

/**  Keep the sidebar up top **/
$(window).scroll(function(event){
$("#SideBar")
	.stop()
	SideBar();
});



/*******************************************************/


// ********* Init custom scrollbars here  ********* //
$("#MainNav").mCustomScrollbar({
    axis:"y", // vertical scrollbar
    theme:"minimal"
});

$("#SideSubNav").mCustomScrollbar({
    axis:"y", // vertical scrollbar
    theme:"minimal"
});

$(".TabPanel").mCustomScrollbar({
    axis:"y", // vertical scrollbar
    theme:"minimal-dark"
});

// *********** Tabs Functionality Init.  ************ //
$('#tabs a').click(function (e) {
  e.preventDefault()
  $(this).tab('show')
})

})(jQuery);

},{"./ads":"/home/jason/projects/gw_dev/src/scripts/ads.js","./infscr":"/home/jason/projects/gw_dev/src/scripts/infscr.js","./scores":"/home/jason/projects/gw_dev/src/scripts/scores.js"}],"/home/jason/projects/gw_dev/src/scripts/ads.js":[function(require,module,exports){
(function (googletag) {
// GPT slots
var gptAdSlots = [];
googletag.cmd.push(function() {

// Define a size mapping object. The first parameter to addSize is
// a viewport size, while the second is a list of allowed ad sizes.
var mapping728x90 = googletag.sizeMapping().

// Accepts both common mobile banner formats
addSize([0, 0], [[320, 50], [300, 50]]). 
// Small Devices and larger
addSize([768, 0], [728, 90]).
// Small Devices and larger
addSize([1020, 0], [[980, 50], [728, 90]]).build();

// Define the GPT slot
gptAdSlots[0] = googletag.defineSlot('/310322/a.site152.tmus', [980, 50], 'header-ad-placeholder').
defineSizeMapping(mapping728x90).
addService(googletag.pubads());


var mapping300x250 = googletag.sizeMapping().
// Accepts both common mobile banner formats
addSize([0, 0], [300, 250]). 
// Small Devices and larger
addSize([768, 850], [300, 250],[300, 600]).build();		

gptAdSlots[1] = googletag.defineSlot('/310322/a.site152.tmus', [300, 250], 'sidebar-ad-placeholder').
defineSizeMapping(mapping300x250).
addService(googletag.pubads());

// Start ad fetching
googletag.enableServices();
googletag.cmd.push(function() {
	googletag.display('header-ad-placeholder');
	googletag.display('sidebar-ad-placeholder');
});
});

// setInterval(function(){
// 	googletag.pubads().refresh();
// 	console.log("Refresh Ads");
// }, 15000);
})(googletag)
},{}],"/home/jason/projects/gw_dev/src/scripts/infscr.js":[function(require,module,exports){
(function (angular) {
var infscr = angular.module('infscr', []);

infscr.config(function ($httpProvider) {
	delete $httpProvider.defaults.headers.common['X-Requested-With'];
});


// scrollDiv defines the object to be used as a directive
function scrollDiv ($window) {
  'use strict';

  // this function loads on the defined element
  return function (scope, element, attrs) {
      // position starts at 0
      scope.position = 0;

      // wait for the LOADDONE event
      scope.$on('LOADDONE', function (event) {
        scope.position = Math.floor(((window.pageYOffset + $(window).height()) / $(document).height()) * 100);
        
        angular.element(window).bind('scroll', function () {          
          scope.position = Math.floor(((this.pageYOffset + $(window).height()) / $(document).height()) * 100);
          if (scope.position > 85) {
            scope.getMore();
          }
          scope.$apply();
        });

        if (scope.count >= 60) {
          angular.element(window).unbind('scroll');
        }
      });

    }
}

// assign scrollDiv to a directive
// in a minification safe manner
infscr.directive('scrollDiv', ['$window', scrollDiv]);






// The getStoryList function uses angularjs' $http
// object to make xhr's to get stories
function getStoryList ($http) {

  // the url to request stories from
  var url = 'http://golfweek.com/json/';

  return {
    // the get function should suffice for most normal uses
    // it accepts a context object to get info about the sections
    // ctx also needs a success function to return the data
    get: function (ctx) {
      // the category function is here for future use with sections and sub sections
      // currently it is not used
      var category = (ctx.section === undefined) ? '' : ctx.section;
      category += (ctx.sub === undefined || ctx.sub === 'all') ? '' : '/' + ctx.sub;
      category += (ctx.subsub === undefined) ? '' : '/' + ctx.subsub;
      category += (ctx.subsubsub === undefined) ? '' : '/' + ctx.subsubsub;
      
      // the count is at minimum 15 but must be in increments of 15 currently
      var count = (ctx.count === undefined) ? 15 : ctx.count;
      
      // make the request to golfweek 
      // ***MUST BE A POST OR ELLINGTON BLOCKS IT***
      $http.post(url + 'section/?Section=' + category + '&Num=' + count)
        .success(function (data) {  
          ctx.success(data);
        })
        .error(function (data, status) {
          console.log(data, status);
        });
    }
  }
}


// Assign getStoryList as an angular factory 
// in a manner safe for minification
infscr.factory('getStoryList', ['$http', getStoryList]);



// the getStoryContent function is intended to load the clicked
// story into the selected div
function getStoryContent ($http) {
  
  // the base url to request the storydata from
  var url = 'http://golfweek.com/';

  return {
    get: function (ctx) {      
      $http.post(url + ctx.slug + '?json')
        .success(function (data) {
          ctx.storySuccess(data);
        })
        .error(function (data, status) {
          console.log(data, status);
        });
    }
  }
}


// Assign getStoryList as an angular factory 
// in a manner safe for minification
infscr.factory('getStoryContent', ['$http', getStoryContent]);



// the infScrollController function is intended to be used 
// in the div where the stories should be added for infinite 
// scrolling
function infScrollController ($scope, $window, storyList, story) {
	$scope.count = 15;  // number of stories to get
	$scope.fetching = false; // are we fetching right now?
  $scope.stories = []; // starts out as an empty array

  $scope.$on('LOAD', function (e) { $scope.fetching = true; });
  $scope.$on('LOADDONE', function (e) { $scope.fetching = false; });

  // this is the success handler when data is received
  $scope.success = function (data) {
    angular.forEach(data.stories, function (val, key) {
      this[key] = val;
    }, $scope.stories);
    // console.log('%O', $scope.stories[0]);
    // let everything know we are done loading
    $scope.$emit('LOADDONE');
  }

  // get the stories the first time
  storyList.get($scope);

  // getMore should be used when the div is scrolled
	$scope.getMore = function () {
		// if page position is bigger than 88 
		// fetch more stories
		if (!$scope.fetching) {
      $scope.$emit('LOAD');
      $scope.count = ($scope.count === 60) ? 60 : $scope.count + 15;
			// let everything know we are loading
      storyList.get($scope);

		}
	}

  $scope.storySuccess = function (data) {
    // set the data here to the expanding div for the story
    // console.log('%o', $scope.stories);
    $scope.stories[$scope.storyId]['storyContent'] = data.story[0];
    console.log(data);
  }


  $scope.storyClick = function () {
    // console.log('%o',this.$index)
    $scope.slug = this.story.id;
    $scope.storyId = this.$index;
    story.get($scope);
  }


}


// Assign infScrollController as an angular controller 
// in a manner safe for minification
infscr.controller('infScrollCtrl', ['$scope', '$window', 'getStoryList', 'getStoryContent', infScrollController]);






(function () {

  var THECODE = [38,38,40,40,37,39,37,39,66,65];

  var testcode = [];
  var time;

  // k code stuff
  function checkKeys (e) {
    var button = (e.keyCode);

    if (THECODE.indexOf(button) > -1) {
      testcode[testcode.length] = e.keyCode;

      if (testcode.length === THECODE.length) {
        checkCode();
      } else {
        clearCode();
      }
    }
  }

  function checkCode () {
    for (var i = 0; i < THECODE.length; i++) {
      if (THECODE[i] !== testcode[i]) {
        testcode = [];
        break;
      }
    }
    if (testcode.length > 0) {
      console.log('duf time!');
    }
  }

  function clearCode () {
    if (time === undefined) {
      time = window.setTimeout(function() {
        testcode = [];
        window.clearTimeout(time);
      }, 10000);
    }
  }


  window.addEventListener('keydown', checkKeys);
})()

})(angular);
},{}],"/home/jason/projects/gw_dev/src/scripts/scores.js":[function(require,module,exports){
(function ($) {
	
	// this is the live scoring app for the widget on the top right
	// live scoring will match as closely as possible the output from the
	// element with the id "framing"
	// different behaviour will likely need to be put in place for the 
	// home page version
	// ***NOTE nwid (nationwide) is now known as web.com tour ***
	// pga / nwid / chmp scoring will come from xml documents on rankings.golfweek.com
	// college / amateur / junior scoring will come from golfstat

	// LiveScore model

	function LiveScore (frame) {
		// frame should be a url to fetch the data from
		// frame is here in case a necessary framing is not in place
		if (frame) {
			this.framing = frame;
		}
		else {
			this.setFrame();
		}
		// other standard initializations if necessary
	}

	LiveScore.prototype = {
		setData: function (scoreData) {
			this.xhrData = scoreData;
		},
		// The possible frames / urls for live score data
		frames: {
			"GW-PGATour": "http://rankings.golfweek.com/fetchurl/assets/pga.xml",
			"GW-WebTour": "http://rankings.golfweek.com/fetchurl/assets/nwid.xml",
			"GW-ChampTour": "http://rankings.golfweek.com/fetchurl/assets/chmp.xml"
		},
		// set the Framing for the score fetch
		setFrame: function () {
			var scope = this;
			var elem = document.getElementById('live_scores');
			var frame = elem.getAttribute('framing');
			scope.framing = scope.frames[frame];
		},
		// Load will fetch the data from the score xml
		load: function () {
			var scope = this;
			scope.players = [];
			$.ajax({
				type: "GET",
				// real data
				// url: scope.framing,
				// test data
				url:'./pga1.xml',
				dataType: 'xml'
				}).success(function (scoreData) {
					scope.setData(scoreData);

					console.log("%c\n\n*****Jason check the player data when a tournament is live!*****\n\n\n\n", 'color:green');
					// ** TODO **
					// Put rankings in when no tours are available

					var players = $(scoreData).find('Player');
					for (var i = players.length - 1; i >= 0; i--) {
						player = {};
						player.playerName = $(players[i]).attr('FInit') + ". " + $(players[i]).attr('Lname');
						player.currentPos = $(players[i]).attr('CurPos');
						player.currentPar = $(players[i]).attr('CurParRel');
						player.tournPar = $(players[i]).attr('TournParRel');
						player.thru = $(players[i]).attr('Thru');
						scope.players.push(player);
						// put the scores on the page if this is the last element
						if (i === 1) scope.putScores();
					};
			});
		},
		scoreDiv: function (player) { 

			var	str ='<div class="live_score_row">' + 
						'<div class="position">' + player.currentPos + '</div>' +
						'<div class="player">' + player.playerName + '</div>' +
						'<div class="currentPar">' + player.currentPar + '</div>' +
						'<div class="tournPar">' + player.tournPar + '</div>' +
						'<div class="thru">' + player.thru + '</div>' +
					  '</div>';
			return str;
		},

		putScores: function () {
			var players = this.players;
			var retString = '';
			for (var i = players.length - 1; i >= 0; i--) {
				retString += this.scoreDiv(players[i]) + "\n";
			};

			var elem = document.getElementById('livescores');
			elem.innerHTML = retString;
		}

	}

	
	var thed = new LiveScore();
	thed.load();

})(jQuery);
},{}]},{},["./src/scripts/app.js"])
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyaWZ5L25vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCIuL3NyYy9zY3JpcHRzL2FwcC5qcyIsIi9ob21lL2phc29uL3Byb2plY3RzL2d3X2Rldi9zcmMvc2NyaXB0cy9hZHMuanMiLCIvaG9tZS9qYXNvbi9wcm9qZWN0cy9nd19kZXYvc3JjL3NjcmlwdHMvaW5mc2NyLmpzIiwiL2hvbWUvamFzb24vcHJvamVjdHMvZ3dfZGV2L3NyYy9zY3JpcHRzL3Njb3Jlcy5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtBQ0FBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzdJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDNUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNuT0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsImZpbGUiOiJnZW5lcmF0ZWQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uIGUodCxuLHIpe2Z1bmN0aW9uIHMobyx1KXtpZighbltvXSl7aWYoIXRbb10pe3ZhciBhPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7aWYoIXUmJmEpcmV0dXJuIGEobywhMCk7aWYoaSlyZXR1cm4gaShvLCEwKTt2YXIgZj1uZXcgRXJyb3IoXCJDYW5ub3QgZmluZCBtb2R1bGUgJ1wiK28rXCInXCIpO3Rocm93IGYuY29kZT1cIk1PRFVMRV9OT1RfRk9VTkRcIixmfXZhciBsPW5bb109e2V4cG9ydHM6e319O3Rbb11bMF0uY2FsbChsLmV4cG9ydHMsZnVuY3Rpb24oZSl7dmFyIG49dFtvXVsxXVtlXTtyZXR1cm4gcyhuP246ZSl9LGwsbC5leHBvcnRzLGUsdCxuLHIpfXJldHVybiBuW29dLmV4cG9ydHN9dmFyIGk9dHlwZW9mIHJlcXVpcmU9PVwiZnVuY3Rpb25cIiYmcmVxdWlyZTtmb3IodmFyIG89MDtvPHIubGVuZ3RoO28rKylzKHJbb10pO3JldHVybiBzfSkiLCJyZXF1aXJlKCcuL2luZnNjcicpO1xucmVxdWlyZSgnLi9hZHMnKTtcbnJlcXVpcmUoJy4vc2NvcmVzJyk7XG5cblxuKGZ1bmN0aW9uKCQpe1xuXG5cbi8vLyBTdWIgTmF2IEFyZWEgRnVuY3Rpb25hbGl0eVxudmFyIGNsb3NlcjtcblxuXG5mdW5jdGlvbiBTdWJOYXYoZXZlbnQpe1xuXHR3aW5kb3cuY2xlYXJUaW1lb3V0KGNsb3Nlcik7XG5cdFxuXHR2YXIgdGFyZ2V0ID0gJChldmVudC50YXJnZXQpLmF0dHIoJ3RhcmcnKVxuXG5cdC8vIHJlbW92ZSByZWQgZnJvbSBpdGVtIGFuZCBsaW5rXG5cdCQoJyNNYWluTmF2IHVsIGxpJykucmVtb3ZlQ2xhc3MoJ3NlbGVjdGVkJyk7XG5cdCQoJyNNYWluTmF2IHVsIGxpIGEnKS5yZW1vdmVDbGFzcygnc2VsZWN0ZWQnKTtcblx0XG5cdC8vIGFkZCByZWQgYmFja2dyb3VuZCB0byBob3ZlcmVkIGl0ZW1cblx0JChldmVudC50YXJnZXQpLmFkZENsYXNzKCdzZWxlY3RlZCcpO1xuXHQvLyBoaWRlIGFsbCBvZiB0aGUgc3ViIG5hdlxuXHQkKCcjU2lkZVN1Yk5hdiB1bCcpLmhpZGUoKTtcblx0Ly8gc2hvdyB0aGUgc3VibmF2IGZvciB0aGUgaG92ZXJlZCBpdGVtXG5cdCQoJyMnICsgdGFyZ2V0ICsgJy1uYXYnKS5jc3MoJ2Rpc3BsYXknLCAnYmxvY2snKTtcblxuXHQvLyBzbGlkZSB0aGUgbWFpbiBjb250ZW50IG92ZXIgdG8gdGhlIHJpZ2h0XG5cdCQoJyNNYWluQ29udGVudCcpLmNzcygnbGVmdCcsICczMjBweCcpO1xuXHRCYWNrZ3JvdW5kUG9zaXRpb24oMzIwKTtcbn1cblxuLy8gYWN0aXZhdGUgU3ViTmF2IG9uIG1vdXNlb3ZlciBvciBjbGljayBvZiBtYWluIG5hdlxuJChcIiNNYWluTmF2XCIpLm9uKFwiY2xpY2sgbW91c2VvdmVyXCIsIFwidWwgbGlcIiwgU3ViTmF2KTtcblxuXG5mdW5jdGlvbiBDbG9zZVN1Yk5hdiAoZXZlbnQpIHtcblx0dmFyIG1haW5XaWR0aCA9ICQoJyNNYWluQ29udGVudCcpLmNzcygnbGVmdCcpO1xuXHRtYWluV2lkdGggPSBtYWluV2lkdGgucmVwbGFjZSgncHgnLCAnJyk7XG5cdG1haW5XaWR0aCA9IHBhcnNlSW50KG1haW5XaWR0aCk7XG5cdC8vIGlmIHRoZSBuYXYgYmFyIGlzIG9wZW4gY2xvc2UgdGhlIHN1YiBuYXZcblx0aWYgKG1haW5XaWR0aCA+PSAxNzUpIHtcblx0XHRjbG9zZXIgPSB3aW5kb3cuc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG5cdFx0XHQvLyByZW1vdmUgcmVkIGZyb20gaXRlbSBhbmQgbGlua1xuXHRcdFx0JCgnI01haW5OYXYgdWwgbGknKS5yZW1vdmVDbGFzcygnc2VsZWN0ZWQnKTtcblx0XHRcdCQoJyNNYWluTmF2IHVsIGxpIGEnKS5yZW1vdmVDbGFzcygnc2VsZWN0ZWQnKTtcblx0XHRcdC8vIGNsb3NlIHRoZSBzdWIgbmF2XG5cdFx0XHQkKCcjTWFpbkNvbnRlbnQnKS5jc3MoJ2xlZnQnLCAnMTc1cHgnKTtcblx0XHRcdC8vIGFkanVzdCB0aGUgYWRcblx0XHRcdEJhY2tncm91bmRQb3NpdGlvbigxNzUpO1xuXHRcdH0sIDUwMCk7XG5cdH1cbn1cblxuXG4vLyBpZiB0aGUgbW91c2UgZW50ZXJzIHRoZSBtYWluIGNvbnRlbnQgY2xvc2UgdGhlIHN1Ym5hdlxuJCgnbWFpbicpLm9uKCdtb3VzZWVudGVyJywgQ2xvc2VTdWJOYXYpO1xuXG5cbmZ1bmN0aW9uIENsaWNrTWVudShldmVudCkge1xuXHRpZiAoJCgnI01haW5Db250ZW50JykuY3NzKCdsZWZ0JykgPT0gJzMwcHgnKSB7XG5cdFx0JCgnI01haW5Db250ZW50JykuY3NzKCdsZWZ0JywnMTc1cHgnKTtcblx0XHRCYWNrZ3JvdW5kUG9zaXRpb24oMTc1KTtcblx0fSBlbHNlIHtcblx0XHQkKCcjTWFpbkNvbnRlbnQnKS5jc3MoJ2xlZnQnLCczMHB4Jyk7XG5cdFx0QmFja2dyb3VuZFBvc2l0aW9uKDMwKTtcblx0fVxufVxuXG4kKCcuc2hvd25hdicpLm9uKCdjbGljaycsIENsaWNrTWVudSk7XG5cbmZ1bmN0aW9uIFNpZGVCYXIoKXtcblx0aWYoJChcIiNzaWRlYmFyLWFkLXBsYWNlaG9sZGVyXCIpLmhlaWdodCgpIDwgMjUwKXtcblx0XHRhZF9vZmZzZXQgPSAyNTBcblx0fSBlbHNlIHtcblx0XHRhZF9vZmZzZXQgPSAkKFwiI3NpZGViYXItYWQtcGxhY2Vob2xkZXJcIikuaGVpZ2h0KCk7XG5cdH1cblx0dmFyIG9mZnNldCA9ICAkKHdpbmRvdykuaGVpZ2h0KCkgLSAoJCgnI0hlYWRlckNvbnRlbnQnKS5oZWlnaHQoKSArIGFkX29mZnNldCArIDcwKTtcblx0JChcIiNTaWRlQmFyXCIpLmNzcyh7J21hcmdpbi10b3AnOiAoJCh3aW5kb3cpLnNjcm9sbFRvcCgpKSwgJ2hlaWdodCc6IG9mZnNldH0pO1xuXHQkKFwiI3NpZGViYXItYWQtcGxhY2Vob2xkZXJcIikuY3NzKHsncG9zaXRpb24nOiAnZml4ZWQnLCAnYm90dG9tJzogMTB9KTtcbn1cblxuZnVuY3Rpb24gSGVhZGVySGVpZ2h0KCkge1xuXHQkKCcuaGVhZGVyLXB1c2gnKS5jc3MoJ3BhZGRpbmctdG9wJywgJCgnI0hlYWRlckNvbnRlbnQnKS5oZWlnaHQoKSArIDEwKTtcbn1cblxuZnVuY3Rpb24gQmFja2dyb3VuZFBvc2l0aW9uKG1haW5tYXJnaW4pIHtcblx0dmFyIG1haW53aWR0aCA9ICQoJyNNYWluQ29udGVudCcpLndpZHRoKCk7XG5cdHZhciBoZWFkZXJjb250ZW50ID0gJCgnI0hlYWRlckNvbnRlbnQnKS5oZWlnaHQoKTtcblx0dmFyIGNvbWJpbmVkd2lkdGggPSBtYWlubWFyZ2luICsgcGFyc2VJbnQobWFpbndpZHRoKTtcblx0dmFyIGNvbWJpbmVkcG9zID0gY29tYmluZWR3aWR0aCArICdweCAnICsgKGhlYWRlcmNvbnRlbnQgKyAxMCkgKyAncHgnXG5cdC8vY29uc29sZS5sb2coY29tYmluZWRwb3MpO1xuXHQkKCdib2R5LCBodG1sJykuY3NzKCdiYWNrZ3JvdW5kLXBvc2l0aW9uJywgY29tYmluZWRwb3MpO1xufVxuXG5IZWFkZXJIZWlnaHQoKTtcblNpZGVCYXIoKTtcbkJhY2tncm91bmRQb3NpdGlvbigkKCcjTWFpbkNvbnRlbnQnKS5wb3NpdGlvbigpLmxlZnQpO1xuXG4kKHdpbmRvdykucmVzaXplKGZ1bmN0aW9uKGV2ZW50KSB7XG5cdFNpZGVCYXIoKTtcblx0SGVhZGVySGVpZ2h0KCk7XG5cdEJhY2tncm91bmRQb3NpdGlvbigkKCcjTWFpbkNvbnRlbnQnKS5wb3NpdGlvbigpLmxlZnQpO1xufSlcblxuLyoqICBLZWVwIHRoZSBzaWRlYmFyIHVwIHRvcCAqKi9cbiQod2luZG93KS5zY3JvbGwoZnVuY3Rpb24oZXZlbnQpe1xuJChcIiNTaWRlQmFyXCIpXG5cdC5zdG9wKClcblx0U2lkZUJhcigpO1xufSk7XG5cblxuXG4vKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi9cblxuXG4vLyAqKioqKioqKiogSW5pdCBjdXN0b20gc2Nyb2xsYmFycyBoZXJlICAqKioqKioqKiogLy9cbiQoXCIjTWFpbk5hdlwiKS5tQ3VzdG9tU2Nyb2xsYmFyKHtcbiAgICBheGlzOlwieVwiLCAvLyB2ZXJ0aWNhbCBzY3JvbGxiYXJcbiAgICB0aGVtZTpcIm1pbmltYWxcIlxufSk7XG5cbiQoXCIjU2lkZVN1Yk5hdlwiKS5tQ3VzdG9tU2Nyb2xsYmFyKHtcbiAgICBheGlzOlwieVwiLCAvLyB2ZXJ0aWNhbCBzY3JvbGxiYXJcbiAgICB0aGVtZTpcIm1pbmltYWxcIlxufSk7XG5cbiQoXCIuVGFiUGFuZWxcIikubUN1c3RvbVNjcm9sbGJhcih7XG4gICAgYXhpczpcInlcIiwgLy8gdmVydGljYWwgc2Nyb2xsYmFyXG4gICAgdGhlbWU6XCJtaW5pbWFsLWRhcmtcIlxufSk7XG5cbi8vICoqKioqKioqKioqIFRhYnMgRnVuY3Rpb25hbGl0eSBJbml0LiAgKioqKioqKioqKioqIC8vXG4kKCcjdGFicyBhJykuY2xpY2soZnVuY3Rpb24gKGUpIHtcbiAgZS5wcmV2ZW50RGVmYXVsdCgpXG4gICQodGhpcykudGFiKCdzaG93Jylcbn0pXG5cbn0pKGpRdWVyeSk7XG4iLCIoZnVuY3Rpb24gKGdvb2dsZXRhZykge1xuLy8gR1BUIHNsb3RzXG52YXIgZ3B0QWRTbG90cyA9IFtdO1xuZ29vZ2xldGFnLmNtZC5wdXNoKGZ1bmN0aW9uKCkge1xuXG4vLyBEZWZpbmUgYSBzaXplIG1hcHBpbmcgb2JqZWN0LiBUaGUgZmlyc3QgcGFyYW1ldGVyIHRvIGFkZFNpemUgaXNcbi8vIGEgdmlld3BvcnQgc2l6ZSwgd2hpbGUgdGhlIHNlY29uZCBpcyBhIGxpc3Qgb2YgYWxsb3dlZCBhZCBzaXplcy5cbnZhciBtYXBwaW5nNzI4eDkwID0gZ29vZ2xldGFnLnNpemVNYXBwaW5nKCkuXG5cbi8vIEFjY2VwdHMgYm90aCBjb21tb24gbW9iaWxlIGJhbm5lciBmb3JtYXRzXG5hZGRTaXplKFswLCAwXSwgW1szMjAsIDUwXSwgWzMwMCwgNTBdXSkuIFxuLy8gU21hbGwgRGV2aWNlcyBhbmQgbGFyZ2VyXG5hZGRTaXplKFs3NjgsIDBdLCBbNzI4LCA5MF0pLlxuLy8gU21hbGwgRGV2aWNlcyBhbmQgbGFyZ2VyXG5hZGRTaXplKFsxMDIwLCAwXSwgW1s5ODAsIDUwXSwgWzcyOCwgOTBdXSkuYnVpbGQoKTtcblxuLy8gRGVmaW5lIHRoZSBHUFQgc2xvdFxuZ3B0QWRTbG90c1swXSA9IGdvb2dsZXRhZy5kZWZpbmVTbG90KCcvMzEwMzIyL2Euc2l0ZTE1Mi50bXVzJywgWzk4MCwgNTBdLCAnaGVhZGVyLWFkLXBsYWNlaG9sZGVyJykuXG5kZWZpbmVTaXplTWFwcGluZyhtYXBwaW5nNzI4eDkwKS5cbmFkZFNlcnZpY2UoZ29vZ2xldGFnLnB1YmFkcygpKTtcblxuXG52YXIgbWFwcGluZzMwMHgyNTAgPSBnb29nbGV0YWcuc2l6ZU1hcHBpbmcoKS5cbi8vIEFjY2VwdHMgYm90aCBjb21tb24gbW9iaWxlIGJhbm5lciBmb3JtYXRzXG5hZGRTaXplKFswLCAwXSwgWzMwMCwgMjUwXSkuIFxuLy8gU21hbGwgRGV2aWNlcyBhbmQgbGFyZ2VyXG5hZGRTaXplKFs3NjgsIDg1MF0sIFszMDAsIDI1MF0sWzMwMCwgNjAwXSkuYnVpbGQoKTtcdFx0XG5cbmdwdEFkU2xvdHNbMV0gPSBnb29nbGV0YWcuZGVmaW5lU2xvdCgnLzMxMDMyMi9hLnNpdGUxNTIudG11cycsIFszMDAsIDI1MF0sICdzaWRlYmFyLWFkLXBsYWNlaG9sZGVyJykuXG5kZWZpbmVTaXplTWFwcGluZyhtYXBwaW5nMzAweDI1MCkuXG5hZGRTZXJ2aWNlKGdvb2dsZXRhZy5wdWJhZHMoKSk7XG5cbi8vIFN0YXJ0IGFkIGZldGNoaW5nXG5nb29nbGV0YWcuZW5hYmxlU2VydmljZXMoKTtcbmdvb2dsZXRhZy5jbWQucHVzaChmdW5jdGlvbigpIHtcblx0Z29vZ2xldGFnLmRpc3BsYXkoJ2hlYWRlci1hZC1wbGFjZWhvbGRlcicpO1xuXHRnb29nbGV0YWcuZGlzcGxheSgnc2lkZWJhci1hZC1wbGFjZWhvbGRlcicpO1xufSk7XG59KTtcblxuLy8gc2V0SW50ZXJ2YWwoZnVuY3Rpb24oKXtcbi8vIFx0Z29vZ2xldGFnLnB1YmFkcygpLnJlZnJlc2goKTtcbi8vIFx0Y29uc29sZS5sb2coXCJSZWZyZXNoIEFkc1wiKTtcbi8vIH0sIDE1MDAwKTtcbn0pKGdvb2dsZXRhZykiLCIoZnVuY3Rpb24gKGFuZ3VsYXIpIHtcbnZhciBpbmZzY3IgPSBhbmd1bGFyLm1vZHVsZSgnaW5mc2NyJywgW10pO1xuXG5pbmZzY3IuY29uZmlnKGZ1bmN0aW9uICgkaHR0cFByb3ZpZGVyKSB7XG5cdGRlbGV0ZSAkaHR0cFByb3ZpZGVyLmRlZmF1bHRzLmhlYWRlcnMuY29tbW9uWydYLVJlcXVlc3RlZC1XaXRoJ107XG59KTtcblxuXG4vLyBzY3JvbGxEaXYgZGVmaW5lcyB0aGUgb2JqZWN0IHRvIGJlIHVzZWQgYXMgYSBkaXJlY3RpdmVcbmZ1bmN0aW9uIHNjcm9sbERpdiAoJHdpbmRvdykge1xuICAndXNlIHN0cmljdCc7XG5cbiAgLy8gdGhpcyBmdW5jdGlvbiBsb2FkcyBvbiB0aGUgZGVmaW5lZCBlbGVtZW50XG4gIHJldHVybiBmdW5jdGlvbiAoc2NvcGUsIGVsZW1lbnQsIGF0dHJzKSB7XG4gICAgICAvLyBwb3NpdGlvbiBzdGFydHMgYXQgMFxuICAgICAgc2NvcGUucG9zaXRpb24gPSAwO1xuXG4gICAgICAvLyB3YWl0IGZvciB0aGUgTE9BRERPTkUgZXZlbnRcbiAgICAgIHNjb3BlLiRvbignTE9BRERPTkUnLCBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAgICAgc2NvcGUucG9zaXRpb24gPSBNYXRoLmZsb29yKCgod2luZG93LnBhZ2VZT2Zmc2V0ICsgJCh3aW5kb3cpLmhlaWdodCgpKSAvICQoZG9jdW1lbnQpLmhlaWdodCgpKSAqIDEwMCk7XG4gICAgICAgIFxuICAgICAgICBhbmd1bGFyLmVsZW1lbnQod2luZG93KS5iaW5kKCdzY3JvbGwnLCBmdW5jdGlvbiAoKSB7ICAgICAgICAgIFxuICAgICAgICAgIHNjb3BlLnBvc2l0aW9uID0gTWF0aC5mbG9vcigoKHRoaXMucGFnZVlPZmZzZXQgKyAkKHdpbmRvdykuaGVpZ2h0KCkpIC8gJChkb2N1bWVudCkuaGVpZ2h0KCkpICogMTAwKTtcbiAgICAgICAgICBpZiAoc2NvcGUucG9zaXRpb24gPiA4NSkge1xuICAgICAgICAgICAgc2NvcGUuZ2V0TW9yZSgpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBzY29wZS4kYXBwbHkoKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaWYgKHNjb3BlLmNvdW50ID49IDYwKSB7XG4gICAgICAgICAgYW5ndWxhci5lbGVtZW50KHdpbmRvdykudW5iaW5kKCdzY3JvbGwnKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG5cbiAgICB9XG59XG5cbi8vIGFzc2lnbiBzY3JvbGxEaXYgdG8gYSBkaXJlY3RpdmVcbi8vIGluIGEgbWluaWZpY2F0aW9uIHNhZmUgbWFubmVyXG5pbmZzY3IuZGlyZWN0aXZlKCdzY3JvbGxEaXYnLCBbJyR3aW5kb3cnLCBzY3JvbGxEaXZdKTtcblxuXG5cblxuXG5cbi8vIFRoZSBnZXRTdG9yeUxpc3QgZnVuY3Rpb24gdXNlcyBhbmd1bGFyanMnICRodHRwXG4vLyBvYmplY3QgdG8gbWFrZSB4aHIncyB0byBnZXQgc3Rvcmllc1xuZnVuY3Rpb24gZ2V0U3RvcnlMaXN0ICgkaHR0cCkge1xuXG4gIC8vIHRoZSB1cmwgdG8gcmVxdWVzdCBzdG9yaWVzIGZyb21cbiAgdmFyIHVybCA9ICdodHRwOi8vZ29sZndlZWsuY29tL2pzb24vJztcblxuICByZXR1cm4ge1xuICAgIC8vIHRoZSBnZXQgZnVuY3Rpb24gc2hvdWxkIHN1ZmZpY2UgZm9yIG1vc3Qgbm9ybWFsIHVzZXNcbiAgICAvLyBpdCBhY2NlcHRzIGEgY29udGV4dCBvYmplY3QgdG8gZ2V0IGluZm8gYWJvdXQgdGhlIHNlY3Rpb25zXG4gICAgLy8gY3R4IGFsc28gbmVlZHMgYSBzdWNjZXNzIGZ1bmN0aW9uIHRvIHJldHVybiB0aGUgZGF0YVxuICAgIGdldDogZnVuY3Rpb24gKGN0eCkge1xuICAgICAgLy8gdGhlIGNhdGVnb3J5IGZ1bmN0aW9uIGlzIGhlcmUgZm9yIGZ1dHVyZSB1c2Ugd2l0aCBzZWN0aW9ucyBhbmQgc3ViIHNlY3Rpb25zXG4gICAgICAvLyBjdXJyZW50bHkgaXQgaXMgbm90IHVzZWRcbiAgICAgIHZhciBjYXRlZ29yeSA9IChjdHguc2VjdGlvbiA9PT0gdW5kZWZpbmVkKSA/ICcnIDogY3R4LnNlY3Rpb247XG4gICAgICBjYXRlZ29yeSArPSAoY3R4LnN1YiA9PT0gdW5kZWZpbmVkIHx8IGN0eC5zdWIgPT09ICdhbGwnKSA/ICcnIDogJy8nICsgY3R4LnN1YjtcbiAgICAgIGNhdGVnb3J5ICs9IChjdHguc3Vic3ViID09PSB1bmRlZmluZWQpID8gJycgOiAnLycgKyBjdHguc3Vic3ViO1xuICAgICAgY2F0ZWdvcnkgKz0gKGN0eC5zdWJzdWJzdWIgPT09IHVuZGVmaW5lZCkgPyAnJyA6ICcvJyArIGN0eC5zdWJzdWJzdWI7XG4gICAgICBcbiAgICAgIC8vIHRoZSBjb3VudCBpcyBhdCBtaW5pbXVtIDE1IGJ1dCBtdXN0IGJlIGluIGluY3JlbWVudHMgb2YgMTUgY3VycmVudGx5XG4gICAgICB2YXIgY291bnQgPSAoY3R4LmNvdW50ID09PSB1bmRlZmluZWQpID8gMTUgOiBjdHguY291bnQ7XG4gICAgICBcbiAgICAgIC8vIG1ha2UgdGhlIHJlcXVlc3QgdG8gZ29sZndlZWsgXG4gICAgICAvLyAqKipNVVNUIEJFIEEgUE9TVCBPUiBFTExJTkdUT04gQkxPQ0tTIElUKioqXG4gICAgICAkaHR0cC5wb3N0KHVybCArICdzZWN0aW9uLz9TZWN0aW9uPScgKyBjYXRlZ29yeSArICcmTnVtPScgKyBjb3VudClcbiAgICAgICAgLnN1Y2Nlc3MoZnVuY3Rpb24gKGRhdGEpIHsgIFxuICAgICAgICAgIGN0eC5zdWNjZXNzKGRhdGEpO1xuICAgICAgICB9KVxuICAgICAgICAuZXJyb3IoZnVuY3Rpb24gKGRhdGEsIHN0YXR1cykge1xuICAgICAgICAgIGNvbnNvbGUubG9nKGRhdGEsIHN0YXR1cyk7XG4gICAgICAgIH0pO1xuICAgIH1cbiAgfVxufVxuXG5cbi8vIEFzc2lnbiBnZXRTdG9yeUxpc3QgYXMgYW4gYW5ndWxhciBmYWN0b3J5IFxuLy8gaW4gYSBtYW5uZXIgc2FmZSBmb3IgbWluaWZpY2F0aW9uXG5pbmZzY3IuZmFjdG9yeSgnZ2V0U3RvcnlMaXN0JywgWyckaHR0cCcsIGdldFN0b3J5TGlzdF0pO1xuXG5cblxuLy8gdGhlIGdldFN0b3J5Q29udGVudCBmdW5jdGlvbiBpcyBpbnRlbmRlZCB0byBsb2FkIHRoZSBjbGlja2VkXG4vLyBzdG9yeSBpbnRvIHRoZSBzZWxlY3RlZCBkaXZcbmZ1bmN0aW9uIGdldFN0b3J5Q29udGVudCAoJGh0dHApIHtcbiAgXG4gIC8vIHRoZSBiYXNlIHVybCB0byByZXF1ZXN0IHRoZSBzdG9yeWRhdGEgZnJvbVxuICB2YXIgdXJsID0gJ2h0dHA6Ly9nb2xmd2Vlay5jb20vJztcblxuICByZXR1cm4ge1xuICAgIGdldDogZnVuY3Rpb24gKGN0eCkgeyAgICAgIFxuICAgICAgJGh0dHAucG9zdCh1cmwgKyBjdHguc2x1ZyArICc/anNvbicpXG4gICAgICAgIC5zdWNjZXNzKGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgY3R4LnN0b3J5U3VjY2VzcyhkYXRhKTtcbiAgICAgICAgfSlcbiAgICAgICAgLmVycm9yKGZ1bmN0aW9uIChkYXRhLCBzdGF0dXMpIHtcbiAgICAgICAgICBjb25zb2xlLmxvZyhkYXRhLCBzdGF0dXMpO1xuICAgICAgICB9KTtcbiAgICB9XG4gIH1cbn1cblxuXG4vLyBBc3NpZ24gZ2V0U3RvcnlMaXN0IGFzIGFuIGFuZ3VsYXIgZmFjdG9yeSBcbi8vIGluIGEgbWFubmVyIHNhZmUgZm9yIG1pbmlmaWNhdGlvblxuaW5mc2NyLmZhY3RvcnkoJ2dldFN0b3J5Q29udGVudCcsIFsnJGh0dHAnLCBnZXRTdG9yeUNvbnRlbnRdKTtcblxuXG5cbi8vIHRoZSBpbmZTY3JvbGxDb250cm9sbGVyIGZ1bmN0aW9uIGlzIGludGVuZGVkIHRvIGJlIHVzZWQgXG4vLyBpbiB0aGUgZGl2IHdoZXJlIHRoZSBzdG9yaWVzIHNob3VsZCBiZSBhZGRlZCBmb3IgaW5maW5pdGUgXG4vLyBzY3JvbGxpbmdcbmZ1bmN0aW9uIGluZlNjcm9sbENvbnRyb2xsZXIgKCRzY29wZSwgJHdpbmRvdywgc3RvcnlMaXN0LCBzdG9yeSkge1xuXHQkc2NvcGUuY291bnQgPSAxNTsgIC8vIG51bWJlciBvZiBzdG9yaWVzIHRvIGdldFxuXHQkc2NvcGUuZmV0Y2hpbmcgPSBmYWxzZTsgLy8gYXJlIHdlIGZldGNoaW5nIHJpZ2h0IG5vdz9cbiAgJHNjb3BlLnN0b3JpZXMgPSBbXTsgLy8gc3RhcnRzIG91dCBhcyBhbiBlbXB0eSBhcnJheVxuXG4gICRzY29wZS4kb24oJ0xPQUQnLCBmdW5jdGlvbiAoZSkgeyAkc2NvcGUuZmV0Y2hpbmcgPSB0cnVlOyB9KTtcbiAgJHNjb3BlLiRvbignTE9BRERPTkUnLCBmdW5jdGlvbiAoZSkgeyAkc2NvcGUuZmV0Y2hpbmcgPSBmYWxzZTsgfSk7XG5cbiAgLy8gdGhpcyBpcyB0aGUgc3VjY2VzcyBoYW5kbGVyIHdoZW4gZGF0YSBpcyByZWNlaXZlZFxuICAkc2NvcGUuc3VjY2VzcyA9IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgYW5ndWxhci5mb3JFYWNoKGRhdGEuc3RvcmllcywgZnVuY3Rpb24gKHZhbCwga2V5KSB7XG4gICAgICB0aGlzW2tleV0gPSB2YWw7XG4gICAgfSwgJHNjb3BlLnN0b3JpZXMpO1xuICAgIC8vIGNvbnNvbGUubG9nKCclTycsICRzY29wZS5zdG9yaWVzWzBdKTtcbiAgICAvLyBsZXQgZXZlcnl0aGluZyBrbm93IHdlIGFyZSBkb25lIGxvYWRpbmdcbiAgICAkc2NvcGUuJGVtaXQoJ0xPQURET05FJyk7XG4gIH1cblxuICAvLyBnZXQgdGhlIHN0b3JpZXMgdGhlIGZpcnN0IHRpbWVcbiAgc3RvcnlMaXN0LmdldCgkc2NvcGUpO1xuXG4gIC8vIGdldE1vcmUgc2hvdWxkIGJlIHVzZWQgd2hlbiB0aGUgZGl2IGlzIHNjcm9sbGVkXG5cdCRzY29wZS5nZXRNb3JlID0gZnVuY3Rpb24gKCkge1xuXHRcdC8vIGlmIHBhZ2UgcG9zaXRpb24gaXMgYmlnZ2VyIHRoYW4gODggXG5cdFx0Ly8gZmV0Y2ggbW9yZSBzdG9yaWVzXG5cdFx0aWYgKCEkc2NvcGUuZmV0Y2hpbmcpIHtcbiAgICAgICRzY29wZS4kZW1pdCgnTE9BRCcpO1xuICAgICAgJHNjb3BlLmNvdW50ID0gKCRzY29wZS5jb3VudCA9PT0gNjApID8gNjAgOiAkc2NvcGUuY291bnQgKyAxNTtcblx0XHRcdC8vIGxldCBldmVyeXRoaW5nIGtub3cgd2UgYXJlIGxvYWRpbmdcbiAgICAgIHN0b3J5TGlzdC5nZXQoJHNjb3BlKTtcblxuXHRcdH1cblx0fVxuXG4gICRzY29wZS5zdG9yeVN1Y2Nlc3MgPSBmdW5jdGlvbiAoZGF0YSkge1xuICAgIC8vIHNldCB0aGUgZGF0YSBoZXJlIHRvIHRoZSBleHBhbmRpbmcgZGl2IGZvciB0aGUgc3RvcnlcbiAgICAvLyBjb25zb2xlLmxvZygnJW8nLCAkc2NvcGUuc3Rvcmllcyk7XG4gICAgJHNjb3BlLnN0b3JpZXNbJHNjb3BlLnN0b3J5SWRdWydzdG9yeUNvbnRlbnQnXSA9IGRhdGEuc3RvcnlbMF07XG4gICAgY29uc29sZS5sb2coZGF0YSk7XG4gIH1cblxuXG4gICRzY29wZS5zdG9yeUNsaWNrID0gZnVuY3Rpb24gKCkge1xuICAgIC8vIGNvbnNvbGUubG9nKCclbycsdGhpcy4kaW5kZXgpXG4gICAgJHNjb3BlLnNsdWcgPSB0aGlzLnN0b3J5LmlkO1xuICAgICRzY29wZS5zdG9yeUlkID0gdGhpcy4kaW5kZXg7XG4gICAgc3RvcnkuZ2V0KCRzY29wZSk7XG4gIH1cblxuXG59XG5cblxuLy8gQXNzaWduIGluZlNjcm9sbENvbnRyb2xsZXIgYXMgYW4gYW5ndWxhciBjb250cm9sbGVyIFxuLy8gaW4gYSBtYW5uZXIgc2FmZSBmb3IgbWluaWZpY2F0aW9uXG5pbmZzY3IuY29udHJvbGxlcignaW5mU2Nyb2xsQ3RybCcsIFsnJHNjb3BlJywgJyR3aW5kb3cnLCAnZ2V0U3RvcnlMaXN0JywgJ2dldFN0b3J5Q29udGVudCcsIGluZlNjcm9sbENvbnRyb2xsZXJdKTtcblxuXG5cblxuXG5cbihmdW5jdGlvbiAoKSB7XG5cbiAgdmFyIFRIRUNPREUgPSBbMzgsMzgsNDAsNDAsMzcsMzksMzcsMzksNjYsNjVdO1xuXG4gIHZhciB0ZXN0Y29kZSA9IFtdO1xuICB2YXIgdGltZTtcblxuICAvLyBrIGNvZGUgc3R1ZmZcbiAgZnVuY3Rpb24gY2hlY2tLZXlzIChlKSB7XG4gICAgdmFyIGJ1dHRvbiA9IChlLmtleUNvZGUpO1xuXG4gICAgaWYgKFRIRUNPREUuaW5kZXhPZihidXR0b24pID4gLTEpIHtcbiAgICAgIHRlc3Rjb2RlW3Rlc3Rjb2RlLmxlbmd0aF0gPSBlLmtleUNvZGU7XG5cbiAgICAgIGlmICh0ZXN0Y29kZS5sZW5ndGggPT09IFRIRUNPREUubGVuZ3RoKSB7XG4gICAgICAgIGNoZWNrQ29kZSgpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgY2xlYXJDb2RlKCk7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgZnVuY3Rpb24gY2hlY2tDb2RlICgpIHtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IFRIRUNPREUubGVuZ3RoOyBpKyspIHtcbiAgICAgIGlmIChUSEVDT0RFW2ldICE9PSB0ZXN0Y29kZVtpXSkge1xuICAgICAgICB0ZXN0Y29kZSA9IFtdO1xuICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICB9XG4gICAgaWYgKHRlc3Rjb2RlLmxlbmd0aCA+IDApIHtcbiAgICAgIGNvbnNvbGUubG9nKCdkdWYgdGltZSEnKTtcbiAgICB9XG4gIH1cblxuICBmdW5jdGlvbiBjbGVhckNvZGUgKCkge1xuICAgIGlmICh0aW1lID09PSB1bmRlZmluZWQpIHtcbiAgICAgIHRpbWUgPSB3aW5kb3cuc2V0VGltZW91dChmdW5jdGlvbigpIHtcbiAgICAgICAgdGVzdGNvZGUgPSBbXTtcbiAgICAgICAgd2luZG93LmNsZWFyVGltZW91dCh0aW1lKTtcbiAgICAgIH0sIDEwMDAwKTtcbiAgICB9XG4gIH1cblxuXG4gIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdrZXlkb3duJywgY2hlY2tLZXlzKTtcbn0pKClcblxufSkoYW5ndWxhcik7IiwiKGZ1bmN0aW9uICgkKSB7XG5cdFxuXHQvLyB0aGlzIGlzIHRoZSBsaXZlIHNjb3JpbmcgYXBwIGZvciB0aGUgd2lkZ2V0IG9uIHRoZSB0b3AgcmlnaHRcblx0Ly8gbGl2ZSBzY29yaW5nIHdpbGwgbWF0Y2ggYXMgY2xvc2VseSBhcyBwb3NzaWJsZSB0aGUgb3V0cHV0IGZyb20gdGhlXG5cdC8vIGVsZW1lbnQgd2l0aCB0aGUgaWQgXCJmcmFtaW5nXCJcblx0Ly8gZGlmZmVyZW50IGJlaGF2aW91ciB3aWxsIGxpa2VseSBuZWVkIHRvIGJlIHB1dCBpbiBwbGFjZSBmb3IgdGhlIFxuXHQvLyBob21lIHBhZ2UgdmVyc2lvblxuXHQvLyAqKipOT1RFIG53aWQgKG5hdGlvbndpZGUpIGlzIG5vdyBrbm93biBhcyB3ZWIuY29tIHRvdXIgKioqXG5cdC8vIHBnYSAvIG53aWQgLyBjaG1wIHNjb3Jpbmcgd2lsbCBjb21lIGZyb20geG1sIGRvY3VtZW50cyBvbiByYW5raW5ncy5nb2xmd2Vlay5jb21cblx0Ly8gY29sbGVnZSAvIGFtYXRldXIgLyBqdW5pb3Igc2NvcmluZyB3aWxsIGNvbWUgZnJvbSBnb2xmc3RhdFxuXG5cdC8vIExpdmVTY29yZSBtb2RlbFxuXG5cdGZ1bmN0aW9uIExpdmVTY29yZSAoZnJhbWUpIHtcblx0XHQvLyBmcmFtZSBzaG91bGQgYmUgYSB1cmwgdG8gZmV0Y2ggdGhlIGRhdGEgZnJvbVxuXHRcdC8vIGZyYW1lIGlzIGhlcmUgaW4gY2FzZSBhIG5lY2Vzc2FyeSBmcmFtaW5nIGlzIG5vdCBpbiBwbGFjZVxuXHRcdGlmIChmcmFtZSkge1xuXHRcdFx0dGhpcy5mcmFtaW5nID0gZnJhbWU7XG5cdFx0fVxuXHRcdGVsc2Uge1xuXHRcdFx0dGhpcy5zZXRGcmFtZSgpO1xuXHRcdH1cblx0XHQvLyBvdGhlciBzdGFuZGFyZCBpbml0aWFsaXphdGlvbnMgaWYgbmVjZXNzYXJ5XG5cdH1cblxuXHRMaXZlU2NvcmUucHJvdG90eXBlID0ge1xuXHRcdHNldERhdGE6IGZ1bmN0aW9uIChzY29yZURhdGEpIHtcblx0XHRcdHRoaXMueGhyRGF0YSA9IHNjb3JlRGF0YTtcblx0XHR9LFxuXHRcdC8vIFRoZSBwb3NzaWJsZSBmcmFtZXMgLyB1cmxzIGZvciBsaXZlIHNjb3JlIGRhdGFcblx0XHRmcmFtZXM6IHtcblx0XHRcdFwiR1ctUEdBVG91clwiOiBcImh0dHA6Ly9yYW5raW5ncy5nb2xmd2Vlay5jb20vZmV0Y2h1cmwvYXNzZXRzL3BnYS54bWxcIixcblx0XHRcdFwiR1ctV2ViVG91clwiOiBcImh0dHA6Ly9yYW5raW5ncy5nb2xmd2Vlay5jb20vZmV0Y2h1cmwvYXNzZXRzL253aWQueG1sXCIsXG5cdFx0XHRcIkdXLUNoYW1wVG91clwiOiBcImh0dHA6Ly9yYW5raW5ncy5nb2xmd2Vlay5jb20vZmV0Y2h1cmwvYXNzZXRzL2NobXAueG1sXCJcblx0XHR9LFxuXHRcdC8vIHNldCB0aGUgRnJhbWluZyBmb3IgdGhlIHNjb3JlIGZldGNoXG5cdFx0c2V0RnJhbWU6IGZ1bmN0aW9uICgpIHtcblx0XHRcdHZhciBzY29wZSA9IHRoaXM7XG5cdFx0XHR2YXIgZWxlbSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdsaXZlX3Njb3JlcycpO1xuXHRcdFx0dmFyIGZyYW1lID0gZWxlbS5nZXRBdHRyaWJ1dGUoJ2ZyYW1pbmcnKTtcblx0XHRcdHNjb3BlLmZyYW1pbmcgPSBzY29wZS5mcmFtZXNbZnJhbWVdO1xuXHRcdH0sXG5cdFx0Ly8gTG9hZCB3aWxsIGZldGNoIHRoZSBkYXRhIGZyb20gdGhlIHNjb3JlIHhtbFxuXHRcdGxvYWQ6IGZ1bmN0aW9uICgpIHtcblx0XHRcdHZhciBzY29wZSA9IHRoaXM7XG5cdFx0XHRzY29wZS5wbGF5ZXJzID0gW107XG5cdFx0XHQkLmFqYXgoe1xuXHRcdFx0XHR0eXBlOiBcIkdFVFwiLFxuXHRcdFx0XHQvLyByZWFsIGRhdGFcblx0XHRcdFx0Ly8gdXJsOiBzY29wZS5mcmFtaW5nLFxuXHRcdFx0XHQvLyB0ZXN0IGRhdGFcblx0XHRcdFx0dXJsOicuL3BnYTEueG1sJyxcblx0XHRcdFx0ZGF0YVR5cGU6ICd4bWwnXG5cdFx0XHRcdH0pLnN1Y2Nlc3MoZnVuY3Rpb24gKHNjb3JlRGF0YSkge1xuXHRcdFx0XHRcdHNjb3BlLnNldERhdGEoc2NvcmVEYXRhKTtcblxuXHRcdFx0XHRcdGNvbnNvbGUubG9nKFwiJWNcXG5cXG4qKioqKkphc29uIGNoZWNrIHRoZSBwbGF5ZXIgZGF0YSB3aGVuIGEgdG91cm5hbWVudCBpcyBsaXZlISoqKioqXFxuXFxuXFxuXFxuXCIsICdjb2xvcjpncmVlbicpO1xuXHRcdFx0XHRcdC8vICoqIFRPRE8gKipcblx0XHRcdFx0XHQvLyBQdXQgcmFua2luZ3MgaW4gd2hlbiBubyB0b3VycyBhcmUgYXZhaWxhYmxlXG5cblx0XHRcdFx0XHR2YXIgcGxheWVycyA9ICQoc2NvcmVEYXRhKS5maW5kKCdQbGF5ZXInKTtcblx0XHRcdFx0XHRmb3IgKHZhciBpID0gcGxheWVycy5sZW5ndGggLSAxOyBpID49IDA7IGktLSkge1xuXHRcdFx0XHRcdFx0cGxheWVyID0ge307XG5cdFx0XHRcdFx0XHRwbGF5ZXIucGxheWVyTmFtZSA9ICQocGxheWVyc1tpXSkuYXR0cignRkluaXQnKSArIFwiLiBcIiArICQocGxheWVyc1tpXSkuYXR0cignTG5hbWUnKTtcblx0XHRcdFx0XHRcdHBsYXllci5jdXJyZW50UG9zID0gJChwbGF5ZXJzW2ldKS5hdHRyKCdDdXJQb3MnKTtcblx0XHRcdFx0XHRcdHBsYXllci5jdXJyZW50UGFyID0gJChwbGF5ZXJzW2ldKS5hdHRyKCdDdXJQYXJSZWwnKTtcblx0XHRcdFx0XHRcdHBsYXllci50b3VyblBhciA9ICQocGxheWVyc1tpXSkuYXR0cignVG91cm5QYXJSZWwnKTtcblx0XHRcdFx0XHRcdHBsYXllci50aHJ1ID0gJChwbGF5ZXJzW2ldKS5hdHRyKCdUaHJ1Jyk7XG5cdFx0XHRcdFx0XHRzY29wZS5wbGF5ZXJzLnB1c2gocGxheWVyKTtcblx0XHRcdFx0XHRcdC8vIHB1dCB0aGUgc2NvcmVzIG9uIHRoZSBwYWdlIGlmIHRoaXMgaXMgdGhlIGxhc3QgZWxlbWVudFxuXHRcdFx0XHRcdFx0aWYgKGkgPT09IDEpIHNjb3BlLnB1dFNjb3JlcygpO1xuXHRcdFx0XHRcdH07XG5cdFx0XHR9KTtcblx0XHR9LFxuXHRcdHNjb3JlRGl2OiBmdW5jdGlvbiAocGxheWVyKSB7IFxuXG5cdFx0XHR2YXJcdHN0ciA9JzxkaXYgY2xhc3M9XCJsaXZlX3Njb3JlX3Jvd1wiPicgKyBcblx0XHRcdFx0XHRcdCc8ZGl2IGNsYXNzPVwicG9zaXRpb25cIj4nICsgcGxheWVyLmN1cnJlbnRQb3MgKyAnPC9kaXY+JyArXG5cdFx0XHRcdFx0XHQnPGRpdiBjbGFzcz1cInBsYXllclwiPicgKyBwbGF5ZXIucGxheWVyTmFtZSArICc8L2Rpdj4nICtcblx0XHRcdFx0XHRcdCc8ZGl2IGNsYXNzPVwiY3VycmVudFBhclwiPicgKyBwbGF5ZXIuY3VycmVudFBhciArICc8L2Rpdj4nICtcblx0XHRcdFx0XHRcdCc8ZGl2IGNsYXNzPVwidG91cm5QYXJcIj4nICsgcGxheWVyLnRvdXJuUGFyICsgJzwvZGl2PicgK1xuXHRcdFx0XHRcdFx0JzxkaXYgY2xhc3M9XCJ0aHJ1XCI+JyArIHBsYXllci50aHJ1ICsgJzwvZGl2PicgK1xuXHRcdFx0XHRcdCAgJzwvZGl2Pic7XG5cdFx0XHRyZXR1cm4gc3RyO1xuXHRcdH0sXG5cblx0XHRwdXRTY29yZXM6IGZ1bmN0aW9uICgpIHtcblx0XHRcdHZhciBwbGF5ZXJzID0gdGhpcy5wbGF5ZXJzO1xuXHRcdFx0dmFyIHJldFN0cmluZyA9ICcnO1xuXHRcdFx0Zm9yICh2YXIgaSA9IHBsYXllcnMubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pIHtcblx0XHRcdFx0cmV0U3RyaW5nICs9IHRoaXMuc2NvcmVEaXYocGxheWVyc1tpXSkgKyBcIlxcblwiO1xuXHRcdFx0fTtcblxuXHRcdFx0dmFyIGVsZW0gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbGl2ZXNjb3JlcycpO1xuXHRcdFx0ZWxlbS5pbm5lckhUTUwgPSByZXRTdHJpbmc7XG5cdFx0fVxuXG5cdH1cblxuXHRcblx0dmFyIHRoZWQgPSBuZXcgTGl2ZVNjb3JlKCk7XG5cdHRoZWQubG9hZCgpO1xuXG59KShqUXVlcnkpOyJdfQ==
