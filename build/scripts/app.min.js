(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({"./src/scripts/app.js":[function(require,module,exports){
require('./infscr');
require('./ads');
require('./scores');


(function($){


/// Sub Nav Area Functionality
var closer;


function SubNav(event){
	window.clearTimeout(closer);
	
	var target = $(event.target).attr('targ')

	// remove red from item and link
	$('#MainNav ul li').removeClass('selected');
	$('#MainNav ul li a').removeClass('selected');
	
	// add red background to hovered item
	$(event.target).addClass('selected');
	// hide all of the sub nav
	$('#SideSubNav ul').hide();
	// show the subnav for the hovered item
	$('#' + target + '-nav').css('display', 'block');

	// slide the main content over to the right
	$('#MainContent').css('left', '320px');
	BackgroundPosition(320);
}

// activate SubNav on mouseover or click of main nav
$("#MainNav").on("click mouseover", "ul li", SubNav);


function CloseSubNav (event) {
	var mainWidth = $('#MainContent').css('left');
	mainWidth = mainWidth.replace('px', '');
	mainWidth = parseInt(mainWidth);
	// if the nav bar is open close the sub nav
	if (mainWidth >= 175) {
		closer = window.setTimeout(function () {
			// remove red from item and link
			$('#MainNav ul li').removeClass('selected');
			$('#MainNav ul li a').removeClass('selected');
			// close the sub nav
			$('#MainContent').css('left', '175px');
			// adjust the ad
			BackgroundPosition(175);
		}, 500);
	}
}


// if the mouse enters the main content close the subnav
$('main').on('mouseenter', CloseSubNav);


function ClickMenu(event) {
	if ($('#MainContent').css('left') == '30px') {
		$('#MainContent').css('left','175px');
		BackgroundPosition(175);
	} else {
		$('#MainContent').css('left','30px');
		BackgroundPosition(30);
	}
}

$('.shownav').on('click', ClickMenu);

function SideBar(){
	if($("#sidebar-ad-placeholder").height() < 250){
		ad_offset = 250
	} else {
		ad_offset = $("#sidebar-ad-placeholder").height();
	}
	var offset =  $(window).height() - ($('#HeaderContent').height() + ad_offset + 70);
	$("#SideBar").css({'margin-top': ($(window).scrollTop()), 'height': offset});
	$("#sidebar-ad-placeholder").css({'position': 'fixed', 'bottom': 10});
}

function HeaderHeight() {
	$('.header-push').css('padding-top', $('#HeaderContent').height() + 10);
}

function BackgroundPosition(mainmargin) {
	var mainwidth = $('#MainContent').width();
	var headercontent = $('#HeaderContent').height();
	var combinedwidth = mainmargin + parseInt(mainwidth);
	var combinedpos = combinedwidth + 'px ' + (headercontent + 10) + 'px'
	//console.log(combinedpos);
	$('body, html').css('background-position', combinedpos);
}

HeaderHeight();
SideBar();
BackgroundPosition($('#MainContent').position().left);

$(window).resize(function(event) {
	SideBar();
	HeaderHeight();
	BackgroundPosition($('#MainContent').position().left);
})

/**  Keep the sidebar up top **/
$(window).scroll(function(event){
$("#SideBar")
	.stop()
	SideBar();
});



/*******************************************************/


// ********* Init custom scrollbars here  ********* //
$("#MainNav").mCustomScrollbar({
    axis:"y", // vertical scrollbar
    theme:"minimal"
});

$("#SideSubNav").mCustomScrollbar({
    axis:"y", // vertical scrollbar
    theme:"minimal"
});

$(".TabPanel").mCustomScrollbar({
    axis:"y", // vertical scrollbar
    theme:"minimal-dark"
});

// *********** Tabs Functionality Init.  ************ //
$('#tabs a').click(function (e) {
  e.preventDefault()
  $(this).tab('show')
})

})(jQuery);

},{"./ads":"/home/jason/projects/gw_dev/src/scripts/ads.js","./infscr":"/home/jason/projects/gw_dev/src/scripts/infscr.js","./scores":"/home/jason/projects/gw_dev/src/scripts/scores.js"}],"/home/jason/projects/gw_dev/src/scripts/ads.js":[function(require,module,exports){
(function (googletag) {
// GPT slots
var gptAdSlots = [];
googletag.cmd.push(function() {

// Define a size mapping object. The first parameter to addSize is
// a viewport size, while the second is a list of allowed ad sizes.
var mapping728x90 = googletag.sizeMapping().

// Accepts both common mobile banner formats
addSize([0, 0], [[320, 50], [300, 50]]). 
// Small Devices and larger
addSize([768, 0], [728, 90]).
// Small Devices and larger
addSize([1020, 0], [[980, 50], [728, 90]]).build();

// Define the GPT slot
gptAdSlots[0] = googletag.defineSlot('/310322/a.site152.tmus', [980, 50], 'header-ad-placeholder').
defineSizeMapping(mapping728x90).
addService(googletag.pubads());


var mapping300x250 = googletag.sizeMapping().
// Accepts both common mobile banner formats
addSize([0, 0], [300, 250]). 
// Small Devices and larger
addSize([768, 850], [300, 250],[300, 600]).build();		

gptAdSlots[1] = googletag.defineSlot('/310322/a.site152.tmus', [300, 250], 'sidebar-ad-placeholder').
defineSizeMapping(mapping300x250).
addService(googletag.pubads());

// Start ad fetching
googletag.enableServices();
googletag.cmd.push(function() {
	googletag.display('header-ad-placeholder');
	googletag.display('sidebar-ad-placeholder');
});
});

// setInterval(function(){
// 	googletag.pubads().refresh();
// 	console.log("Refresh Ads");
// }, 15000);
})(googletag)
},{}],"/home/jason/projects/gw_dev/src/scripts/infscr.js":[function(require,module,exports){
(function (angular) {
var infscr = angular.module('infscr', []);

infscr.config(function ($httpProvider) {
	delete $httpProvider.defaults.headers.common['X-Requested-With'];
});


// scrollDiv defines the object to be used as a directive
function scrollDiv ($window) {
  'use strict';

  // this function loads on the defined element
  return function (scope, element, attrs) {
      // position starts at 0
      scope.position = 0;

      // wait for the LOADDONE event
      scope.$on('LOADDONE', function (event) {
        scope.position = Math.floor(((window.pageYOffset + $(window).height()) / $(document).height()) * 100);
        
        angular.element(window).bind('scroll', function () {          
          scope.position = Math.floor(((this.pageYOffset + $(window).height()) / $(document).height()) * 100);
          if (scope.position > 85) {
            scope.getMore();
          }
          scope.$apply();
        });

        if (scope.count >= 60) {
          angular.element(window).unbind('scroll');
        }
      });

    }
}

// assign scrollDiv to a directive
// in a minification safe manner
infscr.directive('scrollDiv', ['$window', scrollDiv]);






// The getStoryList function uses angularjs' $http
// object to make xhr's to get stories
function getStoryList ($http) {

  // the url to request stories from
  var url = 'http://golfweek.com/json/';

  return {
    // the get function should suffice for most normal uses
    // it accepts a context object to get info about the sections
    // ctx also needs a success function to return the data
    get: function (ctx) {
      // the category function is here for future use with sections and sub sections
      // currently it is not used
      var category = (ctx.section === undefined) ? '' : ctx.section;
      category += (ctx.sub === undefined || ctx.sub === 'all') ? '' : '/' + ctx.sub;
      category += (ctx.subsub === undefined) ? '' : '/' + ctx.subsub;
      category += (ctx.subsubsub === undefined) ? '' : '/' + ctx.subsubsub;
      
      // the count is at minimum 15 but must be in increments of 15 currently
      var count = (ctx.count === undefined) ? 15 : ctx.count;
      
      // make the request to golfweek 
      // ***MUST BE A POST OR ELLINGTON BLOCKS IT***
      $http.post(url + 'section/?Section=' + category + '&Num=' + count)
        .success(function (data) {  
          ctx.success(data);
        })
        .error(function (data, status) {
          console.log(data, status);
        });
    }
  }
}


// Assign getStoryList as an angular factory 
// in a manner safe for minification
infscr.factory('getStoryList', ['$http', getStoryList]);



// the getStoryContent function is intended to load the clicked
// story into the selected div
function getStoryContent ($http) {
  
  // the base url to request the storydata from
  var url = 'http://golfweek.com/';

  return {
    get: function (ctx) {      
      $http.post(url + ctx.slug + '?json')
        .success(function (data) {
          ctx.storySuccess(data);
        })
        .error(function (data, status) {
          console.log(data, status);
        });
    }
  }
}


// Assign getStoryList as an angular factory 
// in a manner safe for minification
infscr.factory('getStoryContent', ['$http', getStoryContent]);



// the infScrollController function is intended to be used 
// in the div where the stories should be added for infinite 
// scrolling
function infScrollController ($scope, $window, storyList, story) {
	$scope.count = 15;  // number of stories to get
	$scope.fetching = false; // are we fetching right now?
  $scope.stories = []; // starts out as an empty array

  $scope.$on('LOAD', function (e) { $scope.fetching = true; });
  $scope.$on('LOADDONE', function (e) { $scope.fetching = false; });

  // this is the success handler when data is received
  $scope.success = function (data) {
    angular.forEach(data.stories, function (val, key) {
      this[key] = val;
    }, $scope.stories);
    // console.log('%O', $scope.stories[0]);
    // let everything know we are done loading
    $scope.$emit('LOADDONE');
  }

  // get the stories the first time
  storyList.get($scope);

  // getMore should be used when the div is scrolled
	$scope.getMore = function () {
		// if page position is bigger than 88 
		// fetch more stories
		if (!$scope.fetching) {
      $scope.$emit('LOAD');
      $scope.count = ($scope.count === 60) ? 60 : $scope.count + 15;
			// let everything know we are loading
      storyList.get($scope);

		}
	}

  $scope.storySuccess = function (data) {
    // set the data here to the expanding div for the story
    // console.log('%o', $scope.stories);
    $scope.stories[$scope.storyId]['storyContent'] = data.story[0];
    console.log(data);
  }


  $scope.storyClick = function () {
    // console.log('%o',this.$index)
    $scope.slug = this.story.id;
    $scope.storyId = this.$index;
    story.get($scope);
  }


}


// Assign infScrollController as an angular controller 
// in a manner safe for minification
infscr.controller('infScrollCtrl', ['$scope', '$window', 'getStoryList', 'getStoryContent', infScrollController]);






(function () {

  var THECODE = [38,38,40,40,37,39,37,39,66,65];

  var testcode = [];
  var time;

  // k code stuff
  function checkKeys (e) {
    var button = (e.keyCode);

    if (THECODE.indexOf(button) > -1) {
      testcode[testcode.length] = e.keyCode;

      if (testcode.length === THECODE.length) {
        checkCode();
      } else {
        clearCode();
      }
    }
  }

  function checkCode () {
    for (var i = 0; i < THECODE.length; i++) {
      if (THECODE[i] !== testcode[i]) {
        testcode = [];
        break;
      }
    }
    if (testcode.length > 0) {
      console.log('duf time!');
    }
  }

  function clearCode () {
    if (time === undefined) {
      time = window.setTimeout(function() {
        testcode = [];
        window.clearTimeout(time);
      }, 10000);
    }
  }


  window.addEventListener('keydown', checkKeys);
})()

})(angular);
},{}],"/home/jason/projects/gw_dev/src/scripts/scores.js":[function(require,module,exports){
(function ($) {
	
	// this is the live scoring app for the widget on the top right
	// live scoring will match as closely as possible the output from the
	// element with the id "framing"
	// different behaviour will likely need to be put in place for the 
	// home page version
	// ***NOTE nwid (nationwide) is now known as web.com tour ***
	// pga / nwid / chmp scoring will come from xml documents on rankings.golfweek.com
	// college / amateur / junior scoring will come from golfstat


	// LiveScore model

	function LiveScore (frame) {
		// frame should be a url to fetch the data from
		// frame is here in case a necessary framing is not in place
		if (frame) {
			this.framing = frame;
		}
		else {
			this.setFrame();
		}
		// other standard initializations if necessary
	}

	LiveScore.prototype = {
		setData: function (scoreData) {
			this.xhrData = scoreData;
		},
		// The possible frames / urls for live score data
		frames: {
			"GW-PGATour": "http://rankings.golfweek.com/fetchurl/assets/pga.xml",
			"GW-WebTour": "http://rankings.golfweek.com/fetchurl/assets/nwid.xml",
			"GW-ChampTour": "http://rankings.golfweek.com/fetchurl/assets/chmp.xml"
		},
		// set the Framing for the score fetch
		setFrame: function () {
			var scope = this;
			var elem = document.getElementById('live_scores');
			var frame = elem.getAttribute('framing');
			scope.framing = scope.frames[frame];
		},
		// Load will fetch the data from the score xml
		load: function () {
			var scope = this;
			scope.players = [];
			$.ajax({
				type: "GET",
				// real data
				// url: scope.framing,
				// test data
				url:'./pga1.xml',
				dataType: 'xml'
				}).success(function (scoreData) {
					scope.setData(scoreData);

					console.log("%c\n\n*****Jason check the player data when a tournament is live!*****\n\n\n\n", 'color:green');
					// ** TODO **
					// Put rankings in when no tours are available

					var players = $(scoreData).find('Player');
					for (var i = players.length - 1; i >= 0; i--) {
						player = {};
						player.playerName = $(players[i]).attr('FInit') + ". " + $(players[i]).attr('Lname');
						player.currentPos = $(players[i]).attr('CurPos');
						player.currentPar = $(players[i]).attr('CurParRel');
						player.tournPar = $(players[i]).attr('TournParRel');
						player.thru = $(players[i]).attr('Thru');
						scope.players.push(player);
						// put the scores on the page if this is the last element
						if (i === 1) scope.putScores();
					};
			});
		},
		scoreDiv: function (player) { 

			var	str ='<div class="live_score_row">' + 
						'<div class="position">' + player.currentPos + '</div>' +
						'<div class="player">' + player.playerName + '</div>' +
						'<div class="currentPar">' + player.currentPar + '</div>' +
						'<div class="tournPar">' + player.tournPar + '</div>' +
						'<div class="thru">' + player.thru + '</div>' +
					  '</div>';
			return str;
		},

		putScores: function () {
			var players = this.players;
			var retString = '';
			for (var i = players.length - 1; i >= 0; i--) {
				retString += this.scoreDiv(players[i]) + "\n";
			};

			var elem = document.getElementById('livescores');
			elem.innerHTML = retString;
		}

	}

	
	var thed = new LiveScore();
	thed.load();

})(jQuery);
},{}]},{},["./src/scripts/app.js"])
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyaWZ5L25vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCIuL3NyYy9zY3JpcHRzL2FwcC5qcyIsIi9ob21lL2phc29uL3Byb2plY3RzL2d3X2Rldi9zcmMvc2NyaXB0cy9hZHMuanMiLCIvaG9tZS9qYXNvbi9wcm9qZWN0cy9nd19kZXYvc3JjL3NjcmlwdHMvaW5mc2NyLmpzIiwiL2hvbWUvamFzb24vcHJvamVjdHMvZ3dfZGV2L3NyYy9zY3JpcHRzL3Njb3Jlcy5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtBQ0FBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzdJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDNUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNuT0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwiZmlsZSI6ImdlbmVyYXRlZC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24gZSh0LG4scil7ZnVuY3Rpb24gcyhvLHUpe2lmKCFuW29dKXtpZighdFtvXSl7dmFyIGE9dHlwZW9mIHJlcXVpcmU9PVwiZnVuY3Rpb25cIiYmcmVxdWlyZTtpZighdSYmYSlyZXR1cm4gYShvLCEwKTtpZihpKXJldHVybiBpKG8sITApO3ZhciBmPW5ldyBFcnJvcihcIkNhbm5vdCBmaW5kIG1vZHVsZSAnXCIrbytcIidcIik7dGhyb3cgZi5jb2RlPVwiTU9EVUxFX05PVF9GT1VORFwiLGZ9dmFyIGw9bltvXT17ZXhwb3J0czp7fX07dFtvXVswXS5jYWxsKGwuZXhwb3J0cyxmdW5jdGlvbihlKXt2YXIgbj10W29dWzFdW2VdO3JldHVybiBzKG4/bjplKX0sbCxsLmV4cG9ydHMsZSx0LG4scil9cmV0dXJuIG5bb10uZXhwb3J0c312YXIgaT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2Zvcih2YXIgbz0wO288ci5sZW5ndGg7bysrKXMocltvXSk7cmV0dXJuIHN9KSIsInJlcXVpcmUoJy4vaW5mc2NyJyk7XG5yZXF1aXJlKCcuL2FkcycpO1xucmVxdWlyZSgnLi9zY29yZXMnKTtcblxuXG4oZnVuY3Rpb24oJCl7XG5cblxuLy8vIFN1YiBOYXYgQXJlYSBGdW5jdGlvbmFsaXR5XG52YXIgY2xvc2VyO1xuXG5cbmZ1bmN0aW9uIFN1Yk5hdihldmVudCl7XG5cdHdpbmRvdy5jbGVhclRpbWVvdXQoY2xvc2VyKTtcblx0XG5cdHZhciB0YXJnZXQgPSAkKGV2ZW50LnRhcmdldCkuYXR0cigndGFyZycpXG5cblx0Ly8gcmVtb3ZlIHJlZCBmcm9tIGl0ZW0gYW5kIGxpbmtcblx0JCgnI01haW5OYXYgdWwgbGknKS5yZW1vdmVDbGFzcygnc2VsZWN0ZWQnKTtcblx0JCgnI01haW5OYXYgdWwgbGkgYScpLnJlbW92ZUNsYXNzKCdzZWxlY3RlZCcpO1xuXHRcblx0Ly8gYWRkIHJlZCBiYWNrZ3JvdW5kIHRvIGhvdmVyZWQgaXRlbVxuXHQkKGV2ZW50LnRhcmdldCkuYWRkQ2xhc3MoJ3NlbGVjdGVkJyk7XG5cdC8vIGhpZGUgYWxsIG9mIHRoZSBzdWIgbmF2XG5cdCQoJyNTaWRlU3ViTmF2IHVsJykuaGlkZSgpO1xuXHQvLyBzaG93IHRoZSBzdWJuYXYgZm9yIHRoZSBob3ZlcmVkIGl0ZW1cblx0JCgnIycgKyB0YXJnZXQgKyAnLW5hdicpLmNzcygnZGlzcGxheScsICdibG9jaycpO1xuXG5cdC8vIHNsaWRlIHRoZSBtYWluIGNvbnRlbnQgb3ZlciB0byB0aGUgcmlnaHRcblx0JCgnI01haW5Db250ZW50JykuY3NzKCdsZWZ0JywgJzMyMHB4Jyk7XG5cdEJhY2tncm91bmRQb3NpdGlvbigzMjApO1xufVxuXG4vLyBhY3RpdmF0ZSBTdWJOYXYgb24gbW91c2VvdmVyIG9yIGNsaWNrIG9mIG1haW4gbmF2XG4kKFwiI01haW5OYXZcIikub24oXCJjbGljayBtb3VzZW92ZXJcIiwgXCJ1bCBsaVwiLCBTdWJOYXYpO1xuXG5cbmZ1bmN0aW9uIENsb3NlU3ViTmF2IChldmVudCkge1xuXHR2YXIgbWFpbldpZHRoID0gJCgnI01haW5Db250ZW50JykuY3NzKCdsZWZ0Jyk7XG5cdG1haW5XaWR0aCA9IG1haW5XaWR0aC5yZXBsYWNlKCdweCcsICcnKTtcblx0bWFpbldpZHRoID0gcGFyc2VJbnQobWFpbldpZHRoKTtcblx0Ly8gaWYgdGhlIG5hdiBiYXIgaXMgb3BlbiBjbG9zZSB0aGUgc3ViIG5hdlxuXHRpZiAobWFpbldpZHRoID49IDE3NSkge1xuXHRcdGNsb3NlciA9IHdpbmRvdy5zZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcblx0XHRcdC8vIHJlbW92ZSByZWQgZnJvbSBpdGVtIGFuZCBsaW5rXG5cdFx0XHQkKCcjTWFpbk5hdiB1bCBsaScpLnJlbW92ZUNsYXNzKCdzZWxlY3RlZCcpO1xuXHRcdFx0JCgnI01haW5OYXYgdWwgbGkgYScpLnJlbW92ZUNsYXNzKCdzZWxlY3RlZCcpO1xuXHRcdFx0Ly8gY2xvc2UgdGhlIHN1YiBuYXZcblx0XHRcdCQoJyNNYWluQ29udGVudCcpLmNzcygnbGVmdCcsICcxNzVweCcpO1xuXHRcdFx0Ly8gYWRqdXN0IHRoZSBhZFxuXHRcdFx0QmFja2dyb3VuZFBvc2l0aW9uKDE3NSk7XG5cdFx0fSwgNTAwKTtcblx0fVxufVxuXG5cbi8vIGlmIHRoZSBtb3VzZSBlbnRlcnMgdGhlIG1haW4gY29udGVudCBjbG9zZSB0aGUgc3VibmF2XG4kKCdtYWluJykub24oJ21vdXNlZW50ZXInLCBDbG9zZVN1Yk5hdik7XG5cblxuZnVuY3Rpb24gQ2xpY2tNZW51KGV2ZW50KSB7XG5cdGlmICgkKCcjTWFpbkNvbnRlbnQnKS5jc3MoJ2xlZnQnKSA9PSAnMzBweCcpIHtcblx0XHQkKCcjTWFpbkNvbnRlbnQnKS5jc3MoJ2xlZnQnLCcxNzVweCcpO1xuXHRcdEJhY2tncm91bmRQb3NpdGlvbigxNzUpO1xuXHR9IGVsc2Uge1xuXHRcdCQoJyNNYWluQ29udGVudCcpLmNzcygnbGVmdCcsJzMwcHgnKTtcblx0XHRCYWNrZ3JvdW5kUG9zaXRpb24oMzApO1xuXHR9XG59XG5cbiQoJy5zaG93bmF2Jykub24oJ2NsaWNrJywgQ2xpY2tNZW51KTtcblxuZnVuY3Rpb24gU2lkZUJhcigpe1xuXHRpZigkKFwiI3NpZGViYXItYWQtcGxhY2Vob2xkZXJcIikuaGVpZ2h0KCkgPCAyNTApe1xuXHRcdGFkX29mZnNldCA9IDI1MFxuXHR9IGVsc2Uge1xuXHRcdGFkX29mZnNldCA9ICQoXCIjc2lkZWJhci1hZC1wbGFjZWhvbGRlclwiKS5oZWlnaHQoKTtcblx0fVxuXHR2YXIgb2Zmc2V0ID0gICQod2luZG93KS5oZWlnaHQoKSAtICgkKCcjSGVhZGVyQ29udGVudCcpLmhlaWdodCgpICsgYWRfb2Zmc2V0ICsgNzApO1xuXHQkKFwiI1NpZGVCYXJcIikuY3NzKHsnbWFyZ2luLXRvcCc6ICgkKHdpbmRvdykuc2Nyb2xsVG9wKCkpLCAnaGVpZ2h0Jzogb2Zmc2V0fSk7XG5cdCQoXCIjc2lkZWJhci1hZC1wbGFjZWhvbGRlclwiKS5jc3Moeydwb3NpdGlvbic6ICdmaXhlZCcsICdib3R0b20nOiAxMH0pO1xufVxuXG5mdW5jdGlvbiBIZWFkZXJIZWlnaHQoKSB7XG5cdCQoJy5oZWFkZXItcHVzaCcpLmNzcygncGFkZGluZy10b3AnLCAkKCcjSGVhZGVyQ29udGVudCcpLmhlaWdodCgpICsgMTApO1xufVxuXG5mdW5jdGlvbiBCYWNrZ3JvdW5kUG9zaXRpb24obWFpbm1hcmdpbikge1xuXHR2YXIgbWFpbndpZHRoID0gJCgnI01haW5Db250ZW50Jykud2lkdGgoKTtcblx0dmFyIGhlYWRlcmNvbnRlbnQgPSAkKCcjSGVhZGVyQ29udGVudCcpLmhlaWdodCgpO1xuXHR2YXIgY29tYmluZWR3aWR0aCA9IG1haW5tYXJnaW4gKyBwYXJzZUludChtYWlud2lkdGgpO1xuXHR2YXIgY29tYmluZWRwb3MgPSBjb21iaW5lZHdpZHRoICsgJ3B4ICcgKyAoaGVhZGVyY29udGVudCArIDEwKSArICdweCdcblx0Ly9jb25zb2xlLmxvZyhjb21iaW5lZHBvcyk7XG5cdCQoJ2JvZHksIGh0bWwnKS5jc3MoJ2JhY2tncm91bmQtcG9zaXRpb24nLCBjb21iaW5lZHBvcyk7XG59XG5cbkhlYWRlckhlaWdodCgpO1xuU2lkZUJhcigpO1xuQmFja2dyb3VuZFBvc2l0aW9uKCQoJyNNYWluQ29udGVudCcpLnBvc2l0aW9uKCkubGVmdCk7XG5cbiQod2luZG93KS5yZXNpemUoZnVuY3Rpb24oZXZlbnQpIHtcblx0U2lkZUJhcigpO1xuXHRIZWFkZXJIZWlnaHQoKTtcblx0QmFja2dyb3VuZFBvc2l0aW9uKCQoJyNNYWluQ29udGVudCcpLnBvc2l0aW9uKCkubGVmdCk7XG59KVxuXG4vKiogIEtlZXAgdGhlIHNpZGViYXIgdXAgdG9wICoqL1xuJCh3aW5kb3cpLnNjcm9sbChmdW5jdGlvbihldmVudCl7XG4kKFwiI1NpZGVCYXJcIilcblx0LnN0b3AoKVxuXHRTaWRlQmFyKCk7XG59KTtcblxuXG5cbi8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqL1xuXG5cbi8vICoqKioqKioqKiBJbml0IGN1c3RvbSBzY3JvbGxiYXJzIGhlcmUgICoqKioqKioqKiAvL1xuJChcIiNNYWluTmF2XCIpLm1DdXN0b21TY3JvbGxiYXIoe1xuICAgIGF4aXM6XCJ5XCIsIC8vIHZlcnRpY2FsIHNjcm9sbGJhclxuICAgIHRoZW1lOlwibWluaW1hbFwiXG59KTtcblxuJChcIiNTaWRlU3ViTmF2XCIpLm1DdXN0b21TY3JvbGxiYXIoe1xuICAgIGF4aXM6XCJ5XCIsIC8vIHZlcnRpY2FsIHNjcm9sbGJhclxuICAgIHRoZW1lOlwibWluaW1hbFwiXG59KTtcblxuJChcIi5UYWJQYW5lbFwiKS5tQ3VzdG9tU2Nyb2xsYmFyKHtcbiAgICBheGlzOlwieVwiLCAvLyB2ZXJ0aWNhbCBzY3JvbGxiYXJcbiAgICB0aGVtZTpcIm1pbmltYWwtZGFya1wiXG59KTtcblxuLy8gKioqKioqKioqKiogVGFicyBGdW5jdGlvbmFsaXR5IEluaXQuICAqKioqKioqKioqKiogLy9cbiQoJyN0YWJzIGEnKS5jbGljayhmdW5jdGlvbiAoZSkge1xuICBlLnByZXZlbnREZWZhdWx0KClcbiAgJCh0aGlzKS50YWIoJ3Nob3cnKVxufSlcblxufSkoalF1ZXJ5KTtcbiIsIihmdW5jdGlvbiAoZ29vZ2xldGFnKSB7XG4vLyBHUFQgc2xvdHNcbnZhciBncHRBZFNsb3RzID0gW107XG5nb29nbGV0YWcuY21kLnB1c2goZnVuY3Rpb24oKSB7XG5cbi8vIERlZmluZSBhIHNpemUgbWFwcGluZyBvYmplY3QuIFRoZSBmaXJzdCBwYXJhbWV0ZXIgdG8gYWRkU2l6ZSBpc1xuLy8gYSB2aWV3cG9ydCBzaXplLCB3aGlsZSB0aGUgc2Vjb25kIGlzIGEgbGlzdCBvZiBhbGxvd2VkIGFkIHNpemVzLlxudmFyIG1hcHBpbmc3Mjh4OTAgPSBnb29nbGV0YWcuc2l6ZU1hcHBpbmcoKS5cblxuLy8gQWNjZXB0cyBib3RoIGNvbW1vbiBtb2JpbGUgYmFubmVyIGZvcm1hdHNcbmFkZFNpemUoWzAsIDBdLCBbWzMyMCwgNTBdLCBbMzAwLCA1MF1dKS4gXG4vLyBTbWFsbCBEZXZpY2VzIGFuZCBsYXJnZXJcbmFkZFNpemUoWzc2OCwgMF0sIFs3MjgsIDkwXSkuXG4vLyBTbWFsbCBEZXZpY2VzIGFuZCBsYXJnZXJcbmFkZFNpemUoWzEwMjAsIDBdLCBbWzk4MCwgNTBdLCBbNzI4LCA5MF1dKS5idWlsZCgpO1xuXG4vLyBEZWZpbmUgdGhlIEdQVCBzbG90XG5ncHRBZFNsb3RzWzBdID0gZ29vZ2xldGFnLmRlZmluZVNsb3QoJy8zMTAzMjIvYS5zaXRlMTUyLnRtdXMnLCBbOTgwLCA1MF0sICdoZWFkZXItYWQtcGxhY2Vob2xkZXInKS5cbmRlZmluZVNpemVNYXBwaW5nKG1hcHBpbmc3Mjh4OTApLlxuYWRkU2VydmljZShnb29nbGV0YWcucHViYWRzKCkpO1xuXG5cbnZhciBtYXBwaW5nMzAweDI1MCA9IGdvb2dsZXRhZy5zaXplTWFwcGluZygpLlxuLy8gQWNjZXB0cyBib3RoIGNvbW1vbiBtb2JpbGUgYmFubmVyIGZvcm1hdHNcbmFkZFNpemUoWzAsIDBdLCBbMzAwLCAyNTBdKS4gXG4vLyBTbWFsbCBEZXZpY2VzIGFuZCBsYXJnZXJcbmFkZFNpemUoWzc2OCwgODUwXSwgWzMwMCwgMjUwXSxbMzAwLCA2MDBdKS5idWlsZCgpO1x0XHRcblxuZ3B0QWRTbG90c1sxXSA9IGdvb2dsZXRhZy5kZWZpbmVTbG90KCcvMzEwMzIyL2Euc2l0ZTE1Mi50bXVzJywgWzMwMCwgMjUwXSwgJ3NpZGViYXItYWQtcGxhY2Vob2xkZXInKS5cbmRlZmluZVNpemVNYXBwaW5nKG1hcHBpbmczMDB4MjUwKS5cbmFkZFNlcnZpY2UoZ29vZ2xldGFnLnB1YmFkcygpKTtcblxuLy8gU3RhcnQgYWQgZmV0Y2hpbmdcbmdvb2dsZXRhZy5lbmFibGVTZXJ2aWNlcygpO1xuZ29vZ2xldGFnLmNtZC5wdXNoKGZ1bmN0aW9uKCkge1xuXHRnb29nbGV0YWcuZGlzcGxheSgnaGVhZGVyLWFkLXBsYWNlaG9sZGVyJyk7XG5cdGdvb2dsZXRhZy5kaXNwbGF5KCdzaWRlYmFyLWFkLXBsYWNlaG9sZGVyJyk7XG59KTtcbn0pO1xuXG4vLyBzZXRJbnRlcnZhbChmdW5jdGlvbigpe1xuLy8gXHRnb29nbGV0YWcucHViYWRzKCkucmVmcmVzaCgpO1xuLy8gXHRjb25zb2xlLmxvZyhcIlJlZnJlc2ggQWRzXCIpO1xuLy8gfSwgMTUwMDApO1xufSkoZ29vZ2xldGFnKSIsIihmdW5jdGlvbiAoYW5ndWxhcikge1xudmFyIGluZnNjciA9IGFuZ3VsYXIubW9kdWxlKCdpbmZzY3InLCBbXSk7XG5cbmluZnNjci5jb25maWcoZnVuY3Rpb24gKCRodHRwUHJvdmlkZXIpIHtcblx0ZGVsZXRlICRodHRwUHJvdmlkZXIuZGVmYXVsdHMuaGVhZGVycy5jb21tb25bJ1gtUmVxdWVzdGVkLVdpdGgnXTtcbn0pO1xuXG5cbi8vIHNjcm9sbERpdiBkZWZpbmVzIHRoZSBvYmplY3QgdG8gYmUgdXNlZCBhcyBhIGRpcmVjdGl2ZVxuZnVuY3Rpb24gc2Nyb2xsRGl2ICgkd2luZG93KSB7XG4gICd1c2Ugc3RyaWN0JztcblxuICAvLyB0aGlzIGZ1bmN0aW9uIGxvYWRzIG9uIHRoZSBkZWZpbmVkIGVsZW1lbnRcbiAgcmV0dXJuIGZ1bmN0aW9uIChzY29wZSwgZWxlbWVudCwgYXR0cnMpIHtcbiAgICAgIC8vIHBvc2l0aW9uIHN0YXJ0cyBhdCAwXG4gICAgICBzY29wZS5wb3NpdGlvbiA9IDA7XG5cbiAgICAgIC8vIHdhaXQgZm9yIHRoZSBMT0FERE9ORSBldmVudFxuICAgICAgc2NvcGUuJG9uKCdMT0FERE9ORScsIGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgICBzY29wZS5wb3NpdGlvbiA9IE1hdGguZmxvb3IoKCh3aW5kb3cucGFnZVlPZmZzZXQgKyAkKHdpbmRvdykuaGVpZ2h0KCkpIC8gJChkb2N1bWVudCkuaGVpZ2h0KCkpICogMTAwKTtcbiAgICAgICAgXG4gICAgICAgIGFuZ3VsYXIuZWxlbWVudCh3aW5kb3cpLmJpbmQoJ3Njcm9sbCcsIGZ1bmN0aW9uICgpIHsgICAgICAgICAgXG4gICAgICAgICAgc2NvcGUucG9zaXRpb24gPSBNYXRoLmZsb29yKCgodGhpcy5wYWdlWU9mZnNldCArICQod2luZG93KS5oZWlnaHQoKSkgLyAkKGRvY3VtZW50KS5oZWlnaHQoKSkgKiAxMDApO1xuICAgICAgICAgIGlmIChzY29wZS5wb3NpdGlvbiA+IDg1KSB7XG4gICAgICAgICAgICBzY29wZS5nZXRNb3JlKCk7XG4gICAgICAgICAgfVxuICAgICAgICAgIHNjb3BlLiRhcHBseSgpO1xuICAgICAgICB9KTtcblxuICAgICAgICBpZiAoc2NvcGUuY291bnQgPj0gNjApIHtcbiAgICAgICAgICBhbmd1bGFyLmVsZW1lbnQod2luZG93KS51bmJpbmQoJ3Njcm9sbCcpO1xuICAgICAgICB9XG4gICAgICB9KTtcblxuICAgIH1cbn1cblxuLy8gYXNzaWduIHNjcm9sbERpdiB0byBhIGRpcmVjdGl2ZVxuLy8gaW4gYSBtaW5pZmljYXRpb24gc2FmZSBtYW5uZXJcbmluZnNjci5kaXJlY3RpdmUoJ3Njcm9sbERpdicsIFsnJHdpbmRvdycsIHNjcm9sbERpdl0pO1xuXG5cblxuXG5cblxuLy8gVGhlIGdldFN0b3J5TGlzdCBmdW5jdGlvbiB1c2VzIGFuZ3VsYXJqcycgJGh0dHBcbi8vIG9iamVjdCB0byBtYWtlIHhocidzIHRvIGdldCBzdG9yaWVzXG5mdW5jdGlvbiBnZXRTdG9yeUxpc3QgKCRodHRwKSB7XG5cbiAgLy8gdGhlIHVybCB0byByZXF1ZXN0IHN0b3JpZXMgZnJvbVxuICB2YXIgdXJsID0gJ2h0dHA6Ly9nb2xmd2Vlay5jb20vanNvbi8nO1xuXG4gIHJldHVybiB7XG4gICAgLy8gdGhlIGdldCBmdW5jdGlvbiBzaG91bGQgc3VmZmljZSBmb3IgbW9zdCBub3JtYWwgdXNlc1xuICAgIC8vIGl0IGFjY2VwdHMgYSBjb250ZXh0IG9iamVjdCB0byBnZXQgaW5mbyBhYm91dCB0aGUgc2VjdGlvbnNcbiAgICAvLyBjdHggYWxzbyBuZWVkcyBhIHN1Y2Nlc3MgZnVuY3Rpb24gdG8gcmV0dXJuIHRoZSBkYXRhXG4gICAgZ2V0OiBmdW5jdGlvbiAoY3R4KSB7XG4gICAgICAvLyB0aGUgY2F0ZWdvcnkgZnVuY3Rpb24gaXMgaGVyZSBmb3IgZnV0dXJlIHVzZSB3aXRoIHNlY3Rpb25zIGFuZCBzdWIgc2VjdGlvbnNcbiAgICAgIC8vIGN1cnJlbnRseSBpdCBpcyBub3QgdXNlZFxuICAgICAgdmFyIGNhdGVnb3J5ID0gKGN0eC5zZWN0aW9uID09PSB1bmRlZmluZWQpID8gJycgOiBjdHguc2VjdGlvbjtcbiAgICAgIGNhdGVnb3J5ICs9IChjdHguc3ViID09PSB1bmRlZmluZWQgfHwgY3R4LnN1YiA9PT0gJ2FsbCcpID8gJycgOiAnLycgKyBjdHguc3ViO1xuICAgICAgY2F0ZWdvcnkgKz0gKGN0eC5zdWJzdWIgPT09IHVuZGVmaW5lZCkgPyAnJyA6ICcvJyArIGN0eC5zdWJzdWI7XG4gICAgICBjYXRlZ29yeSArPSAoY3R4LnN1YnN1YnN1YiA9PT0gdW5kZWZpbmVkKSA/ICcnIDogJy8nICsgY3R4LnN1YnN1YnN1YjtcbiAgICAgIFxuICAgICAgLy8gdGhlIGNvdW50IGlzIGF0IG1pbmltdW0gMTUgYnV0IG11c3QgYmUgaW4gaW5jcmVtZW50cyBvZiAxNSBjdXJyZW50bHlcbiAgICAgIHZhciBjb3VudCA9IChjdHguY291bnQgPT09IHVuZGVmaW5lZCkgPyAxNSA6IGN0eC5jb3VudDtcbiAgICAgIFxuICAgICAgLy8gbWFrZSB0aGUgcmVxdWVzdCB0byBnb2xmd2VlayBcbiAgICAgIC8vICoqKk1VU1QgQkUgQSBQT1NUIE9SIEVMTElOR1RPTiBCTE9DS1MgSVQqKipcbiAgICAgICRodHRwLnBvc3QodXJsICsgJ3NlY3Rpb24vP1NlY3Rpb249JyArIGNhdGVnb3J5ICsgJyZOdW09JyArIGNvdW50KVxuICAgICAgICAuc3VjY2VzcyhmdW5jdGlvbiAoZGF0YSkgeyAgXG4gICAgICAgICAgY3R4LnN1Y2Nlc3MoZGF0YSk7XG4gICAgICAgIH0pXG4gICAgICAgIC5lcnJvcihmdW5jdGlvbiAoZGF0YSwgc3RhdHVzKSB7XG4gICAgICAgICAgY29uc29sZS5sb2coZGF0YSwgc3RhdHVzKTtcbiAgICAgICAgfSk7XG4gICAgfVxuICB9XG59XG5cblxuLy8gQXNzaWduIGdldFN0b3J5TGlzdCBhcyBhbiBhbmd1bGFyIGZhY3RvcnkgXG4vLyBpbiBhIG1hbm5lciBzYWZlIGZvciBtaW5pZmljYXRpb25cbmluZnNjci5mYWN0b3J5KCdnZXRTdG9yeUxpc3QnLCBbJyRodHRwJywgZ2V0U3RvcnlMaXN0XSk7XG5cblxuXG4vLyB0aGUgZ2V0U3RvcnlDb250ZW50IGZ1bmN0aW9uIGlzIGludGVuZGVkIHRvIGxvYWQgdGhlIGNsaWNrZWRcbi8vIHN0b3J5IGludG8gdGhlIHNlbGVjdGVkIGRpdlxuZnVuY3Rpb24gZ2V0U3RvcnlDb250ZW50ICgkaHR0cCkge1xuICBcbiAgLy8gdGhlIGJhc2UgdXJsIHRvIHJlcXVlc3QgdGhlIHN0b3J5ZGF0YSBmcm9tXG4gIHZhciB1cmwgPSAnaHR0cDovL2dvbGZ3ZWVrLmNvbS8nO1xuXG4gIHJldHVybiB7XG4gICAgZ2V0OiBmdW5jdGlvbiAoY3R4KSB7ICAgICAgXG4gICAgICAkaHR0cC5wb3N0KHVybCArIGN0eC5zbHVnICsgJz9qc29uJylcbiAgICAgICAgLnN1Y2Nlc3MoZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICBjdHguc3RvcnlTdWNjZXNzKGRhdGEpO1xuICAgICAgICB9KVxuICAgICAgICAuZXJyb3IoZnVuY3Rpb24gKGRhdGEsIHN0YXR1cykge1xuICAgICAgICAgIGNvbnNvbGUubG9nKGRhdGEsIHN0YXR1cyk7XG4gICAgICAgIH0pO1xuICAgIH1cbiAgfVxufVxuXG5cbi8vIEFzc2lnbiBnZXRTdG9yeUxpc3QgYXMgYW4gYW5ndWxhciBmYWN0b3J5IFxuLy8gaW4gYSBtYW5uZXIgc2FmZSBmb3IgbWluaWZpY2F0aW9uXG5pbmZzY3IuZmFjdG9yeSgnZ2V0U3RvcnlDb250ZW50JywgWyckaHR0cCcsIGdldFN0b3J5Q29udGVudF0pO1xuXG5cblxuLy8gdGhlIGluZlNjcm9sbENvbnRyb2xsZXIgZnVuY3Rpb24gaXMgaW50ZW5kZWQgdG8gYmUgdXNlZCBcbi8vIGluIHRoZSBkaXYgd2hlcmUgdGhlIHN0b3JpZXMgc2hvdWxkIGJlIGFkZGVkIGZvciBpbmZpbml0ZSBcbi8vIHNjcm9sbGluZ1xuZnVuY3Rpb24gaW5mU2Nyb2xsQ29udHJvbGxlciAoJHNjb3BlLCAkd2luZG93LCBzdG9yeUxpc3QsIHN0b3J5KSB7XG5cdCRzY29wZS5jb3VudCA9IDE1OyAgLy8gbnVtYmVyIG9mIHN0b3JpZXMgdG8gZ2V0XG5cdCRzY29wZS5mZXRjaGluZyA9IGZhbHNlOyAvLyBhcmUgd2UgZmV0Y2hpbmcgcmlnaHQgbm93P1xuICAkc2NvcGUuc3RvcmllcyA9IFtdOyAvLyBzdGFydHMgb3V0IGFzIGFuIGVtcHR5IGFycmF5XG5cbiAgJHNjb3BlLiRvbignTE9BRCcsIGZ1bmN0aW9uIChlKSB7ICRzY29wZS5mZXRjaGluZyA9IHRydWU7IH0pO1xuICAkc2NvcGUuJG9uKCdMT0FERE9ORScsIGZ1bmN0aW9uIChlKSB7ICRzY29wZS5mZXRjaGluZyA9IGZhbHNlOyB9KTtcblxuICAvLyB0aGlzIGlzIHRoZSBzdWNjZXNzIGhhbmRsZXIgd2hlbiBkYXRhIGlzIHJlY2VpdmVkXG4gICRzY29wZS5zdWNjZXNzID0gZnVuY3Rpb24gKGRhdGEpIHtcbiAgICBhbmd1bGFyLmZvckVhY2goZGF0YS5zdG9yaWVzLCBmdW5jdGlvbiAodmFsLCBrZXkpIHtcbiAgICAgIHRoaXNba2V5XSA9IHZhbDtcbiAgICB9LCAkc2NvcGUuc3Rvcmllcyk7XG4gICAgLy8gY29uc29sZS5sb2coJyVPJywgJHNjb3BlLnN0b3JpZXNbMF0pO1xuICAgIC8vIGxldCBldmVyeXRoaW5nIGtub3cgd2UgYXJlIGRvbmUgbG9hZGluZ1xuICAgICRzY29wZS4kZW1pdCgnTE9BRERPTkUnKTtcbiAgfVxuXG4gIC8vIGdldCB0aGUgc3RvcmllcyB0aGUgZmlyc3QgdGltZVxuICBzdG9yeUxpc3QuZ2V0KCRzY29wZSk7XG5cbiAgLy8gZ2V0TW9yZSBzaG91bGQgYmUgdXNlZCB3aGVuIHRoZSBkaXYgaXMgc2Nyb2xsZWRcblx0JHNjb3BlLmdldE1vcmUgPSBmdW5jdGlvbiAoKSB7XG5cdFx0Ly8gaWYgcGFnZSBwb3NpdGlvbiBpcyBiaWdnZXIgdGhhbiA4OCBcblx0XHQvLyBmZXRjaCBtb3JlIHN0b3JpZXNcblx0XHRpZiAoISRzY29wZS5mZXRjaGluZykge1xuICAgICAgJHNjb3BlLiRlbWl0KCdMT0FEJyk7XG4gICAgICAkc2NvcGUuY291bnQgPSAoJHNjb3BlLmNvdW50ID09PSA2MCkgPyA2MCA6ICRzY29wZS5jb3VudCArIDE1O1xuXHRcdFx0Ly8gbGV0IGV2ZXJ5dGhpbmcga25vdyB3ZSBhcmUgbG9hZGluZ1xuICAgICAgc3RvcnlMaXN0LmdldCgkc2NvcGUpO1xuXG5cdFx0fVxuXHR9XG5cbiAgJHNjb3BlLnN0b3J5U3VjY2VzcyA9IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgLy8gc2V0IHRoZSBkYXRhIGhlcmUgdG8gdGhlIGV4cGFuZGluZyBkaXYgZm9yIHRoZSBzdG9yeVxuICAgIC8vIGNvbnNvbGUubG9nKCclbycsICRzY29wZS5zdG9yaWVzKTtcbiAgICAkc2NvcGUuc3Rvcmllc1skc2NvcGUuc3RvcnlJZF1bJ3N0b3J5Q29udGVudCddID0gZGF0YS5zdG9yeVswXTtcbiAgICBjb25zb2xlLmxvZyhkYXRhKTtcbiAgfVxuXG5cbiAgJHNjb3BlLnN0b3J5Q2xpY2sgPSBmdW5jdGlvbiAoKSB7XG4gICAgLy8gY29uc29sZS5sb2coJyVvJyx0aGlzLiRpbmRleClcbiAgICAkc2NvcGUuc2x1ZyA9IHRoaXMuc3RvcnkuaWQ7XG4gICAgJHNjb3BlLnN0b3J5SWQgPSB0aGlzLiRpbmRleDtcbiAgICBzdG9yeS5nZXQoJHNjb3BlKTtcbiAgfVxuXG5cbn1cblxuXG4vLyBBc3NpZ24gaW5mU2Nyb2xsQ29udHJvbGxlciBhcyBhbiBhbmd1bGFyIGNvbnRyb2xsZXIgXG4vLyBpbiBhIG1hbm5lciBzYWZlIGZvciBtaW5pZmljYXRpb25cbmluZnNjci5jb250cm9sbGVyKCdpbmZTY3JvbGxDdHJsJywgWyckc2NvcGUnLCAnJHdpbmRvdycsICdnZXRTdG9yeUxpc3QnLCAnZ2V0U3RvcnlDb250ZW50JywgaW5mU2Nyb2xsQ29udHJvbGxlcl0pO1xuXG5cblxuXG5cblxuKGZ1bmN0aW9uICgpIHtcblxuICB2YXIgVEhFQ09ERSA9IFszOCwzOCw0MCw0MCwzNywzOSwzNywzOSw2Niw2NV07XG5cbiAgdmFyIHRlc3Rjb2RlID0gW107XG4gIHZhciB0aW1lO1xuXG4gIC8vIGsgY29kZSBzdHVmZlxuICBmdW5jdGlvbiBjaGVja0tleXMgKGUpIHtcbiAgICB2YXIgYnV0dG9uID0gKGUua2V5Q29kZSk7XG5cbiAgICBpZiAoVEhFQ09ERS5pbmRleE9mKGJ1dHRvbikgPiAtMSkge1xuICAgICAgdGVzdGNvZGVbdGVzdGNvZGUubGVuZ3RoXSA9IGUua2V5Q29kZTtcblxuICAgICAgaWYgKHRlc3Rjb2RlLmxlbmd0aCA9PT0gVEhFQ09ERS5sZW5ndGgpIHtcbiAgICAgICAgY2hlY2tDb2RlKCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjbGVhckNvZGUoKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBmdW5jdGlvbiBjaGVja0NvZGUgKCkge1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgVEhFQ09ERS5sZW5ndGg7IGkrKykge1xuICAgICAgaWYgKFRIRUNPREVbaV0gIT09IHRlc3Rjb2RlW2ldKSB7XG4gICAgICAgIHRlc3Rjb2RlID0gW107XG4gICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgIH1cbiAgICBpZiAodGVzdGNvZGUubGVuZ3RoID4gMCkge1xuICAgICAgY29uc29sZS5sb2coJ2R1ZiB0aW1lIScpO1xuICAgIH1cbiAgfVxuXG4gIGZ1bmN0aW9uIGNsZWFyQ29kZSAoKSB7XG4gICAgaWYgKHRpbWUgPT09IHVuZGVmaW5lZCkge1xuICAgICAgdGltZSA9IHdpbmRvdy5zZXRUaW1lb3V0KGZ1bmN0aW9uKCkge1xuICAgICAgICB0ZXN0Y29kZSA9IFtdO1xuICAgICAgICB3aW5kb3cuY2xlYXJUaW1lb3V0KHRpbWUpO1xuICAgICAgfSwgMTAwMDApO1xuICAgIH1cbiAgfVxuXG5cbiAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ2tleWRvd24nLCBjaGVja0tleXMpO1xufSkoKVxuXG59KShhbmd1bGFyKTsiLCIoZnVuY3Rpb24gKCQpIHtcblx0XG5cdC8vIHRoaXMgaXMgdGhlIGxpdmUgc2NvcmluZyBhcHAgZm9yIHRoZSB3aWRnZXQgb24gdGhlIHRvcCByaWdodFxuXHQvLyBsaXZlIHNjb3Jpbmcgd2lsbCBtYXRjaCBhcyBjbG9zZWx5IGFzIHBvc3NpYmxlIHRoZSBvdXRwdXQgZnJvbSB0aGVcblx0Ly8gZWxlbWVudCB3aXRoIHRoZSBpZCBcImZyYW1pbmdcIlxuXHQvLyBkaWZmZXJlbnQgYmVoYXZpb3VyIHdpbGwgbGlrZWx5IG5lZWQgdG8gYmUgcHV0IGluIHBsYWNlIGZvciB0aGUgXG5cdC8vIGhvbWUgcGFnZSB2ZXJzaW9uXG5cdC8vICoqKk5PVEUgbndpZCAobmF0aW9ud2lkZSkgaXMgbm93IGtub3duIGFzIHdlYi5jb20gdG91ciAqKipcblx0Ly8gcGdhIC8gbndpZCAvIGNobXAgc2NvcmluZyB3aWxsIGNvbWUgZnJvbSB4bWwgZG9jdW1lbnRzIG9uIHJhbmtpbmdzLmdvbGZ3ZWVrLmNvbVxuXHQvLyBjb2xsZWdlIC8gYW1hdGV1ciAvIGp1bmlvciBzY29yaW5nIHdpbGwgY29tZSBmcm9tIGdvbGZzdGF0XG5cblxuXHQvLyBMaXZlU2NvcmUgbW9kZWxcblxuXHRmdW5jdGlvbiBMaXZlU2NvcmUgKGZyYW1lKSB7XG5cdFx0Ly8gZnJhbWUgc2hvdWxkIGJlIGEgdXJsIHRvIGZldGNoIHRoZSBkYXRhIGZyb21cblx0XHQvLyBmcmFtZSBpcyBoZXJlIGluIGNhc2UgYSBuZWNlc3NhcnkgZnJhbWluZyBpcyBub3QgaW4gcGxhY2Vcblx0XHRpZiAoZnJhbWUpIHtcblx0XHRcdHRoaXMuZnJhbWluZyA9IGZyYW1lO1xuXHRcdH1cblx0XHRlbHNlIHtcblx0XHRcdHRoaXMuc2V0RnJhbWUoKTtcblx0XHR9XG5cdFx0Ly8gb3RoZXIgc3RhbmRhcmQgaW5pdGlhbGl6YXRpb25zIGlmIG5lY2Vzc2FyeVxuXHR9XG5cblx0TGl2ZVNjb3JlLnByb3RvdHlwZSA9IHtcblx0XHRzZXREYXRhOiBmdW5jdGlvbiAoc2NvcmVEYXRhKSB7XG5cdFx0XHR0aGlzLnhockRhdGEgPSBzY29yZURhdGE7XG5cdFx0fSxcblx0XHQvLyBUaGUgcG9zc2libGUgZnJhbWVzIC8gdXJscyBmb3IgbGl2ZSBzY29yZSBkYXRhXG5cdFx0ZnJhbWVzOiB7XG5cdFx0XHRcIkdXLVBHQVRvdXJcIjogXCJodHRwOi8vcmFua2luZ3MuZ29sZndlZWsuY29tL2ZldGNodXJsL2Fzc2V0cy9wZ2EueG1sXCIsXG5cdFx0XHRcIkdXLVdlYlRvdXJcIjogXCJodHRwOi8vcmFua2luZ3MuZ29sZndlZWsuY29tL2ZldGNodXJsL2Fzc2V0cy9ud2lkLnhtbFwiLFxuXHRcdFx0XCJHVy1DaGFtcFRvdXJcIjogXCJodHRwOi8vcmFua2luZ3MuZ29sZndlZWsuY29tL2ZldGNodXJsL2Fzc2V0cy9jaG1wLnhtbFwiXG5cdFx0fSxcblx0XHQvLyBzZXQgdGhlIEZyYW1pbmcgZm9yIHRoZSBzY29yZSBmZXRjaFxuXHRcdHNldEZyYW1lOiBmdW5jdGlvbiAoKSB7XG5cdFx0XHR2YXIgc2NvcGUgPSB0aGlzO1xuXHRcdFx0dmFyIGVsZW0gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbGl2ZV9zY29yZXMnKTtcblx0XHRcdHZhciBmcmFtZSA9IGVsZW0uZ2V0QXR0cmlidXRlKCdmcmFtaW5nJyk7XG5cdFx0XHRzY29wZS5mcmFtaW5nID0gc2NvcGUuZnJhbWVzW2ZyYW1lXTtcblx0XHR9LFxuXHRcdC8vIExvYWQgd2lsbCBmZXRjaCB0aGUgZGF0YSBmcm9tIHRoZSBzY29yZSB4bWxcblx0XHRsb2FkOiBmdW5jdGlvbiAoKSB7XG5cdFx0XHR2YXIgc2NvcGUgPSB0aGlzO1xuXHRcdFx0c2NvcGUucGxheWVycyA9IFtdO1xuXHRcdFx0JC5hamF4KHtcblx0XHRcdFx0dHlwZTogXCJHRVRcIixcblx0XHRcdFx0Ly8gcmVhbCBkYXRhXG5cdFx0XHRcdC8vIHVybDogc2NvcGUuZnJhbWluZyxcblx0XHRcdFx0Ly8gdGVzdCBkYXRhXG5cdFx0XHRcdHVybDonLi9wZ2ExLnhtbCcsXG5cdFx0XHRcdGRhdGFUeXBlOiAneG1sJ1xuXHRcdFx0XHR9KS5zdWNjZXNzKGZ1bmN0aW9uIChzY29yZURhdGEpIHtcblx0XHRcdFx0XHRzY29wZS5zZXREYXRhKHNjb3JlRGF0YSk7XG5cblx0XHRcdFx0XHRjb25zb2xlLmxvZyhcIiVjXFxuXFxuKioqKipKYXNvbiBjaGVjayB0aGUgcGxheWVyIGRhdGEgd2hlbiBhIHRvdXJuYW1lbnQgaXMgbGl2ZSEqKioqKlxcblxcblxcblxcblwiLCAnY29sb3I6Z3JlZW4nKTtcblx0XHRcdFx0XHQvLyAqKiBUT0RPICoqXG5cdFx0XHRcdFx0Ly8gUHV0IHJhbmtpbmdzIGluIHdoZW4gbm8gdG91cnMgYXJlIGF2YWlsYWJsZVxuXG5cdFx0XHRcdFx0dmFyIHBsYXllcnMgPSAkKHNjb3JlRGF0YSkuZmluZCgnUGxheWVyJyk7XG5cdFx0XHRcdFx0Zm9yICh2YXIgaSA9IHBsYXllcnMubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pIHtcblx0XHRcdFx0XHRcdHBsYXllciA9IHt9O1xuXHRcdFx0XHRcdFx0cGxheWVyLnBsYXllck5hbWUgPSAkKHBsYXllcnNbaV0pLmF0dHIoJ0ZJbml0JykgKyBcIi4gXCIgKyAkKHBsYXllcnNbaV0pLmF0dHIoJ0xuYW1lJyk7XG5cdFx0XHRcdFx0XHRwbGF5ZXIuY3VycmVudFBvcyA9ICQocGxheWVyc1tpXSkuYXR0cignQ3VyUG9zJyk7XG5cdFx0XHRcdFx0XHRwbGF5ZXIuY3VycmVudFBhciA9ICQocGxheWVyc1tpXSkuYXR0cignQ3VyUGFyUmVsJyk7XG5cdFx0XHRcdFx0XHRwbGF5ZXIudG91cm5QYXIgPSAkKHBsYXllcnNbaV0pLmF0dHIoJ1RvdXJuUGFyUmVsJyk7XG5cdFx0XHRcdFx0XHRwbGF5ZXIudGhydSA9ICQocGxheWVyc1tpXSkuYXR0cignVGhydScpO1xuXHRcdFx0XHRcdFx0c2NvcGUucGxheWVycy5wdXNoKHBsYXllcik7XG5cdFx0XHRcdFx0XHQvLyBwdXQgdGhlIHNjb3JlcyBvbiB0aGUgcGFnZSBpZiB0aGlzIGlzIHRoZSBsYXN0IGVsZW1lbnRcblx0XHRcdFx0XHRcdGlmIChpID09PSAxKSBzY29wZS5wdXRTY29yZXMoKTtcblx0XHRcdFx0XHR9O1xuXHRcdFx0fSk7XG5cdFx0fSxcblx0XHRzY29yZURpdjogZnVuY3Rpb24gKHBsYXllcikgeyBcblxuXHRcdFx0dmFyXHRzdHIgPSc8ZGl2IGNsYXNzPVwibGl2ZV9zY29yZV9yb3dcIj4nICsgXG5cdFx0XHRcdFx0XHQnPGRpdiBjbGFzcz1cInBvc2l0aW9uXCI+JyArIHBsYXllci5jdXJyZW50UG9zICsgJzwvZGl2PicgK1xuXHRcdFx0XHRcdFx0JzxkaXYgY2xhc3M9XCJwbGF5ZXJcIj4nICsgcGxheWVyLnBsYXllck5hbWUgKyAnPC9kaXY+JyArXG5cdFx0XHRcdFx0XHQnPGRpdiBjbGFzcz1cImN1cnJlbnRQYXJcIj4nICsgcGxheWVyLmN1cnJlbnRQYXIgKyAnPC9kaXY+JyArXG5cdFx0XHRcdFx0XHQnPGRpdiBjbGFzcz1cInRvdXJuUGFyXCI+JyArIHBsYXllci50b3VyblBhciArICc8L2Rpdj4nICtcblx0XHRcdFx0XHRcdCc8ZGl2IGNsYXNzPVwidGhydVwiPicgKyBwbGF5ZXIudGhydSArICc8L2Rpdj4nICtcblx0XHRcdFx0XHQgICc8L2Rpdj4nO1xuXHRcdFx0cmV0dXJuIHN0cjtcblx0XHR9LFxuXG5cdFx0cHV0U2NvcmVzOiBmdW5jdGlvbiAoKSB7XG5cdFx0XHR2YXIgcGxheWVycyA9IHRoaXMucGxheWVycztcblx0XHRcdHZhciByZXRTdHJpbmcgPSAnJztcblx0XHRcdGZvciAodmFyIGkgPSBwbGF5ZXJzLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSB7XG5cdFx0XHRcdHJldFN0cmluZyArPSB0aGlzLnNjb3JlRGl2KHBsYXllcnNbaV0pICsgXCJcXG5cIjtcblx0XHRcdH07XG5cblx0XHRcdHZhciBlbGVtID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2xpdmVzY29yZXMnKTtcblx0XHRcdGVsZW0uaW5uZXJIVE1MID0gcmV0U3RyaW5nO1xuXHRcdH1cblxuXHR9XG5cblx0XG5cdHZhciB0aGVkID0gbmV3IExpdmVTY29yZSgpO1xuXHR0aGVkLmxvYWQoKTtcblxufSkoalF1ZXJ5KTsiXX0=
